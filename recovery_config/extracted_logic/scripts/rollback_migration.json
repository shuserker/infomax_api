{
  "file_path": "rollback_migration.sh",
  "file_type": ".sh",
  "content": "#!/bin/bash\n# POSCO ì›Œì¹˜í–„ìŠ¤í„° v2.0 ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡¤ë°± ìŠ¤í¬ë¦½íŠ¸\n\nset -e  # ì˜¤ë¥˜ ì‹œ ì¤‘ë‹¨\n\necho \"ðŸ”„ POSCO ì›Œì¹˜í–„ìŠ¤í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡¤ë°± ì‹œìž‘\"\n\n# ìƒ‰ìƒ ì •ì˜\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m' # No Color\n\nprint_step() {\n    echo -e \"${BLUE}[ë‹¨ê³„ $1]${NC} $2\"\n}\n\nprint_success() {\n    echo -e \"${GREEN}âœ… $1${NC}\"\n}\n\nprint_warning() {\n    echo -e \"${YELLOW}âš ï¸ $1${NC}\"\n}\n\nprint_error() {\n    echo -e \"${RED}âŒ $1${NC}\"\n}\n\n# ë°±ì—… ë””ë ‰í† ë¦¬ ì°¾ê¸°\nprint_step \"1\" \"ë°±ì—… ë””ë ‰í† ë¦¬ í™•ì¸\"\n\nBACKUP_DIR=$(ls -1d backup_* 2>/dev/null | tail -1)\n\nif [ -z \"$BACKUP_DIR\" ]; then\n    print_error \"ë°±ì—… ë””ë ‰í† ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\"\n    echo \"ì‚¬ìš© ê°€ëŠ¥í•œ ë°±ì—…:\"\n    ls -1d backup_* 2>/dev/null || echo \"ë°±ì—… ì—†ìŒ\"\n    exit 1\nfi\n\nprint_success \"ë°±ì—… ë””ë ‰í† ë¦¬ ë°œê²¬: $BACKUP_DIR\"\n\n# í˜„ìž¬ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ì¤‘ì§€\nprint_step \"2\" \"í˜„ìž¬ í”„ë¡œì„¸ìŠ¤ ì¤‘ì§€\"\n\nif pgrep -f \"monitor_WatchHamster.py\" > /dev/null; then\n    print_warning \"ì›Œì¹˜í–„ìŠ¤í„° ì¤‘ì§€ ì¤‘...\"\n    pkill -f \"monitor_WatchHamster.py\"\n    sleep 5\nfi\n\nif pgrep -f \"python.*posco\" > /dev/null; then\n    print_warning \"POSCO ê´€ë ¨ í”„ë¡œì„¸ìŠ¤ ì¤‘ì§€ ì¤‘...\"\n    pkill -f \"python.*posco\"\n    sleep 3\nfi\n\nprint_success \"í”„ë¡œì„¸ìŠ¤ ì¤‘ì§€ ì™„ë£Œ\"\n\n# ë°±ì—…ì—ì„œ ë³µì›\nprint_step \"3\" \"ë°±ì—…ì—ì„œ ì‹œìŠ¤í…œ ë³µì›\"\n\n# í˜„ìž¬ v2 ì‹œìŠ¤í…œ ë°±ì—… (ë¡¤ë°± ì „)\nROLLBACK_BACKUP=\"rollback_backup_$(date +%Y%m%d_%H%M%S)\"\nmkdir -p \"$ROLLBACK_BACKUP\"\ncp -r Monitoring/ \"$ROLLBACK_BACKUP/\" 2>/dev/null || true\ncp watchhamster_control_center.sh \"$ROLLBACK_BACKUP/\" 2>/dev/null || true\n\nprint_success \"ë¡¤ë°± ì „ í˜„ìž¬ ìƒíƒœ ë°±ì—…: $ROLLBACK_BACKUP\"\n\n# ë°±ì—…ì—ì„œ ë³µì›\nif [ -d \"$BACKUP_DIR/Monitoring\" ]; then\n    rm -rf Monitoring/\n    cp -r \"$BACKUP_DIR/Monitoring\" ./\n    print_success \"Monitoring ë””ë ‰í† ë¦¬ ë³µì›\"\nfi\n\nif [ -f \"$BACKUP_DIR/watchhamster_control_center.sh\" ]; then\n    cp \"$BACKUP_DIR/watchhamster_control_center.sh\" ./\n    chmod +x watchhamster_control_center.sh\n    print_success \"ì›Œì¹˜í–„ìŠ¤í„° ì œì–´ì„¼í„° ìŠ¤í¬ë¦½íŠ¸ ë³µì›\"\nfi\n\n# ë¡œê·¸ íŒŒì¼ ë³µì› (ì„ íƒì )\nif ls \"$BACKUP_DIR\"/*.log 1> /dev/null 2>&1; then\n    cp \"$BACKUP_DIR\"/*.log ./\n    print_success \"ë¡œê·¸ íŒŒì¼ ë³µì›\"\nfi\n\n# v2 ë””ë ‰í† ë¦¬ ì œê±°\nprint_step \"4\" \"v2 ì•„í‚¤í…ì²˜ ì œê±°\"\n\nif [ -d \"Monitoring/Posco_News_mini_v2\" ]; then\n    rm -rf \"Monitoring/Posco_News_mini_v2\"\n    print_success \"v2 ì•„í‚¤í…ì²˜ ë””ë ‰í† ë¦¬ ì œê±°\"\nfi\n\n# ë³µì› ê²€ì¦\nprint_step \"5\" \"ë³µì› ê²€ì¦\"\n\n# ê¸°ì¡´ ì›Œì¹˜í–„ìŠ¤í„° í…ŒìŠ¤íŠ¸\nprint_warning \"ê¸°ì¡´ ì›Œì¹˜í–„ìŠ¤í„° í…ŒìŠ¤íŠ¸ ì‹œìž‘ (10ì´ˆê°„)...\"\ntimeout 10s python3 Monitoring/Posco_News_mini/monitor_WatchHamster.py &\nTEST_PID=$!\n\nsleep 5\n\nif kill -0 $TEST_PID 2>/dev/null; then\n    print_success \"ê¸°ì¡´ ì›Œì¹˜í–„ìŠ¤í„° í…ŒìŠ¤íŠ¸ ì„±ê³µ\"\n    kill $TEST_PID 2>/dev/null\n    wait $TEST_PID 2>/dev/null || true\nelse\n    print_error \"ê¸°ì¡´ ì›Œì¹˜í–„ìŠ¤í„° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨\"\nfi\n\n# ë¡¤ë°± ì™„ë£Œ\nprint_step \"6\" \"ë¡¤ë°± ì™„ë£Œ\"\n\necho \"\"\necho \"ðŸ”„ POSCO ì›Œì¹˜í–„ìŠ¤í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡¤ë°± ì™„ë£Œ!\"\necho \"\"\necho \"ðŸ“‹ ë¡¤ë°± ê²°ê³¼:\"\necho \"  âœ… ê¸°ì¡´ ì‹œìŠ¤í…œìœ¼ë¡œ ë³µì›\"\necho \"  âœ… v2 ì•„í‚¤í…ì²˜ ì œê±°\"\necho \"  âœ… ë°±ì—…ì—ì„œ ì„¤ì • ë³µì›\"\necho \"\"\necho \"ðŸ“¦ ë°±ì—… ì •ë³´:\"\necho \"  - ì›ë³¸ ë°±ì—…: $BACKUP_DIR\"\necho \"  - ë¡¤ë°± ì „ ë°±ì—…: $ROLLBACK_BACKUP\"\necho \"\"\necho \"ðŸš€ ë‹¤ìŒ ë‹¨ê³„:\"\necho \"  1. ./watchhamster_control_center.sh ì‹¤í–‰\"\necho \"  2. ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ ì‹œìŠ¤í…œ ì‹œìž‘\"\necho \"\"\necho \"ðŸ’¡ ì°¸ê³ :\"\necho \"  - v2ë¡œ ë‹¤ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë ¤ë©´: ./migrate_to_v2.sh\"\necho \"  - ë¬¸ì œ ë°œìƒ ì‹œ ë¡œê·¸ í™•ì¸: tail -f *.log\"\necho \"\"",
  "commands": [
    "set -e  # ì˜¤ë¥˜ ì‹œ ì¤‘ë‹¨",
    "echo \"ðŸ”„ POSCO ì›Œì¹˜í–„ìŠ¤í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡¤ë°± ì‹œìž‘\"",
    "echo -e \"${BLUE}[ë‹¨ê³„ $1]${NC} $2\"",
    "echo -e \"${GREEN}âœ… $1${NC}\"",
    "echo -e \"${YELLOW}âš ï¸ $1${NC}\"",
    "echo -e \"${RED}âŒ $1${NC}\"",
    "echo \"ì‚¬ìš© ê°€ëŠ¥í•œ ë°±ì—…:\"",
    "ls -1d backup_* 2>/dev/null || echo \"ë°±ì—… ì—†ìŒ\"",
    "if pgrep -f \"python.*posco\" > /dev/null; then",
    "pkill -f \"python.*posco\"",
    "timeout 10s python3 Monitoring/Posco_News_mini/monitor_WatchHamster.py &",
    "echo \"\"",
    "echo \"ðŸ”„ POSCO ì›Œì¹˜í–„ìŠ¤í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡¤ë°± ì™„ë£Œ!\"",
    "echo \"\"",
    "echo \"ðŸ“‹ ë¡¤ë°± ê²°ê³¼:\"",
    "echo \"  âœ… ê¸°ì¡´ ì‹œìŠ¤í…œìœ¼ë¡œ ë³µì›\"",
    "echo \"  âœ… v2 ì•„í‚¤í…ì²˜ ì œê±°\"",
    "echo \"  âœ… ë°±ì—…ì—ì„œ ì„¤ì • ë³µì›\"",
    "echo \"\"",
    "echo \"ðŸ“¦ ë°±ì—… ì •ë³´:\"",
    "echo \"  - ì›ë³¸ ë°±ì—…: $BACKUP_DIR\"",
    "echo \"  - ë¡¤ë°± ì „ ë°±ì—…: $ROLLBACK_BACKUP\"",
    "echo \"\"",
    "echo \"ðŸš€ ë‹¤ìŒ ë‹¨ê³„:\"",
    "echo \"  1. ./watchhamster_control_center.sh ì‹¤í–‰\"",
    "echo \"  2. ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ ì‹œìŠ¤í…œ ì‹œìž‘\"",
    "echo \"\"",
    "echo \"ðŸ’¡ ì°¸ê³ :\"",
    "echo \"  - v2ë¡œ ë‹¤ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë ¤ë©´: ./migrate_to_v2.sh\"",
    "echo \"  - ë¬¸ì œ ë°œìƒ ì‹œ ë¡œê·¸ í™•ì¸: tail -f *.log\"",
    "echo \"\""
  ],
  "variables": {
    "RED": "'\\033[0;31m'",
    "GREEN": "'\\033[0;32m'",
    "YELLOW": "'\\033[1;33m'",
    "BLUE": "'\\033[0;34m'",
    "NC": "'\\033[0m' # No Color",
    "BACKUP_DIR": "$(ls -1d backup_* 2>/dev/null | tail -1)",
    "ROLLBACK_BACKUP": "\"rollback_backup_$(date +%Y%m%d_%H%M%S)\"",
    "TEST_PID": "$!"
  }
}