#!/usr/bin/env python3
"""
POSCO í´ë” êµ¬ì¡° ì¬êµ¬ì„± ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
Verification script for POSCO folder structure reorganization

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” í´ë” êµ¬ì¡° ì¬êµ¬ì„±ì´ ì˜¬ë°”ë¥´ê²Œ ì™„ë£Œë˜ì—ˆëŠ”ì§€ ê²€ì¦í•©ë‹ˆë‹¤.
"""

import posco_news_250808_monitor.log
import test_config.json
# BROKEN_REF: from pathlib import Path
# BROKEN_REF: from typing import deployment_verification_checklist.md, Dict, Tuple

class FolderReorganizationVerifier:
    """í´ë” êµ¬ì¡° ì¬êµ¬ì„± ê²€ì¦ í´ë˜ìŠ¤"""
    
    def __init__(self):
        self.base_path = Path(".")
        self.monitoring_path = self.base_path / "Monitoring"
        
        # ì˜ˆìƒë˜ëŠ” ìƒˆë¡œìš´ í´ë” êµ¬ì¡°
        self.expected_folders = [
            "Monitoring/POSCO_News_250808",
            "Monitoring/WatchHamster_v3.0",
            "Monitoring/docs"
        ]
        
        # ê²€ì¦ ê²°ê³¼
        self.verification_results = {
            "folder_structure": {"passed": 0, "failed": 0, "details": []},
            "file_migration": {"passed": 0, "failed": 0, "details": []},
            "path_references": {"passed": 0, "failed": 0, "details": []},
            "overall_status": "unknown"
        }
    
    def verify_folder_structure(self) -> bool:
        """ìƒˆë¡œìš´ í´ë” êµ¬ì¡°ê°€ ì˜¬ë°”ë¥´ê²Œ ìƒì„±ë˜ì—ˆëŠ”ì§€ ê²€ì¦"""
        print("1. í´ë” êµ¬ì¡° ê²€ì¦ ì¤‘...")
        
        all_passed = True
        
        for expected_folder in self.expected_folders:
            folder_path = Path(expected_folder)
            if folder_path.exists() and folder_path.is_dir():
                self.verification_results["folder_structure"]["passed"] += 1
                self.verification_results["folder_structure"]["details"].append({
                    "folder": expected_folder,
                    "status": "ì¡´ì¬í•¨",
                    "result": "PASS"
                })
                print(f"   âœ… {expected_folder} - ì¡´ì¬í•¨")
            else:
                self.verification_results["folder_structure"]["failed"] += 1
                self.verification_results["folder_structure"]["details"].append({
                    "folder": expected_folder,
                    "status": "ì¡´ì¬í•˜ì§€ ì•ŠìŒ",
                    "result": "FAIL"
                })
                print(f"   âŒ {expected_folder} - ì¡´ì¬í•˜ì§€ ì•ŠìŒ")
                all_passed = False
        
        return all_passed
    
    def verify_file_migration(self) -> bool:
        """íŒŒì¼ë“¤ì´ ì˜¬ë°”ë¥´ê²Œ ì´ë™ë˜ì—ˆëŠ”ì§€ ê²€ì¦"""
        print("2. íŒŒì¼ ì´ë™ ê²€ì¦ ì¤‘...")
        
        # POSCO_News_250808 í´ë” ê²€ì¦
        posco_news_path = self.monitoring_path / "POSCO_News_250808"
        watchhamster_path = self.monitoring_path / "WatchHamster_v3.0"
        
        all_passed = True
        
        # POSCO News í´ë” íŒŒì¼ ê²€ì¦
        if posco_news_path.exists():
            posco_files = list(posco_news_path.rglob("*"))
            posco_file_count = len([f for f in posco_files if f.is_file()])
            
            if posco_file_count > 0:
                self.verification_results["file_migration"]["passed"] += 1
                self.verification_results["file_migration"]["details"].append({
                    "folder": "POSCO_News_250808",
                    "file_count": posco_file_count,
                    "status": f"{posco_file_count}ê°œ íŒŒì¼ ì¡´ì¬",
                    "result": "PASS"
                })
                print(f"   âœ… POSCO_News_250808 - {posco_file_count}ê°œ íŒŒì¼ ì¡´ì¬")
            else:
                self.verification_results["file_migration"]["failed"] += 1
                all_passed = False
                print(f"   âŒ POSCO_News_250808 - íŒŒì¼ì´ ì—†ìŒ")
        
        # WatchHamster í´ë” íŒŒì¼ ê²€ì¦
        if watchhamster_path.exists():
            watchhamster_files = list(watchhamster_path.rglob("*"))
            watchhamster_file_count = len([f for f in watchhamster_files if f.is_file()])
            
            if watchhamster_file_count > 0:
                self.verification_results["file_migration"]["passed"] += 1
                self.verification_results["file_migration"]["details"].append({
                    "folder": "WatchHamster_v3.0",
                    "file_count": watchhamster_file_count,
                    "status": f"{watchhamster_file_count}ê°œ íŒŒì¼ ì¡´ì¬",
                    "result": "PASS"
                })
                print(f"   âœ… WatchHamster_v3.0 - {watchhamster_file_count}ê°œ íŒŒì¼ ì¡´ì¬")
            else:
                self.verification_results["file_migration"]["failed"] += 1
                all_passed = False
                print(f"   âŒ WatchHamster_v3.0 - íŒŒì¼ì´ ì—†ìŒ")
        
        return all_passed
    
    def verify_path_references(self) -> bool:
        """ê²½ë¡œ ì°¸ì¡°ê°€ ì˜¬ë°”ë¥´ê²Œ ì—…ë°ì´íŠ¸ë˜ì—ˆëŠ”ì§€ ê²€ì¦"""
        print("3. ê²½ë¡œ ì°¸ì¡° ì—…ë°ì´íŠ¸ ê²€ì¦ ì¤‘...")
        
        # ê²€ì¦í•  íŒŒì¼ íŒ¨í„´
# BROKEN_REF:         file_patterns = ["*.py", "*.sh", "*.bat", "*.md", "*.json"]
        
        # ì´ì „ ê²½ë¡œ íŒ¨í„´ë“¤ (ì´ì œëŠ” ì¡´ì¬í•˜ì§€ ì•Šì•„ì•¼ í•¨)
        old_patterns = [
            "Monitoring/Posco_News_mini/",
            "Monitoring/Posco_News_mini_v2/",
            "Posco_News_mini/",
            "Posco_News_mini_v2/"
        ]
        
        problematic_files = []
        checked_files = 0
        
        # ìƒˆë¡œìš´ í´ë”ë“¤ì—ì„œ íŒŒì¼ ê²€ì‚¬
        for folder_path in [self.monitoring_path / "POSCO_News_250808", self.monitoring_path / "WatchHamster_v3.0"]:
            if folder_path.exists():
                for pattern in file_patterns:
                    for file_path in folder_path.rglob(pattern):
                        if file_path.is_file():
checked_files_+ =  1
                            if self._check_file_for_old_paths(file_path, old_patterns):
                                problematic_files.append(str(file_path))
        
        if len(problematic_files) == 0:
            self.verification_results["path_references"]["passed"] = checked_files
            self.verification_results["path_references"]["details"].append({
                "checked_files": checked_files,
                "problematic_files": 0,
                "status": "ëª¨ë“  ê²½ë¡œ ì°¸ì¡°ê°€ ì—…ë°ì´íŠ¸ë¨",
                "result": "PASS"
            })
            print(f"   âœ… {checked_files}ê°œ íŒŒì¼ ê²€ì‚¬ ì™„ë£Œ - ëª¨ë“  ê²½ë¡œ ì°¸ì¡°ê°€ ì—…ë°ì´íŠ¸ë¨")
            return True
        else:
            self.verification_results["path_references"]["failed"] = len(problematic_files)
            self.verification_results["path_references"]["details"].append({
                "checked_files": checked_files,
                "problematic_files": len(problematic_files),
                "files": problematic_files,
                "status": "ì¼ë¶€ íŒŒì¼ì— ì´ì „ ê²½ë¡œ ì°¸ì¡°ê°€ ë‚¨ì•„ìˆìŒ",
                "result": "FAIL"
            })
            print(f"   âŒ {len(problematic_files)}ê°œ íŒŒì¼ì— ì´ì „ ê²½ë¡œ ì°¸ì¡°ê°€ ë‚¨ì•„ìˆìŒ:")
            for file_path in problematic_files:
                print(f"      - {file_path}")
            return False
    
    def _check_file_for_old_paths(self, file_path: Path, old_patterns: List[str]) -> bool:
        """íŒŒì¼ì— ì´ì „ ê²½ë¡œ íŒ¨í„´ì´ ë‚¨ì•„ìˆëŠ”ì§€ í™•ì¸"""
        try:
with_open(file_path,_'r',_encoding = 'utf-8', errors='ignore') as f:
                content = f.read()
                
            for pattern in old_patterns:
                if pattern in content:
                    return True
            
            return False
            
        except Exception:
            return False
    
    def verify_documentation(self) -> bool:
        """ë¬¸ì„œí™”ê°€ ì˜¬ë°”ë¥´ê²Œ ìƒì„±ë˜ì—ˆëŠ”ì§€ ê²€ì¦"""
        print("4. ë¬¸ì„œí™” ê²€ì¦ ì¤‘...")
        
        doc_path = self.monitoring_path / "Monitoring/FOLDER_STRUCTURE_GUIDE.md"
        log_path = Path("folder_reorganization_log.json")
        
        all_passed = True
        
        if doc_path.exists():
            print(f"   âœ… í´ë” êµ¬ì¡° ê°€ì´ë“œ ë¬¸ì„œ ì¡´ì¬: {doc_path}")
        else:
            print(f"   âŒ í´ë” êµ¬ì¡° ê°€ì´ë“œ ë¬¸ì„œ ì—†ìŒ: {doc_path}")
            all_passed = False
        
        if log_path.exists():
            print(f"   âœ… ì¬êµ¬ì„± ë¡œê·¸ íŒŒì¼ ì¡´ì¬: {log_path}")
        else:
            print(f"   âŒ ì¬êµ¬ì„± ë¡œê·¸ íŒŒì¼ ì—†ìŒ: {log_path}")
            all_passed = False
        
        return all_passed
    
    def run_verification(self) -> bool:
        """ì „ì²´ ê²€ì¦ ì‹¤í–‰"""
        print("POSCO í´ë” êµ¬ì¡° ì¬êµ¬ì„± ê²€ì¦ ì‹œì‘")
        print("=" * 50)
        
        # ê° ê²€ì¦ ë‹¨ê³„ ì‹¤í–‰
        folder_ok = self.verify_folder_structure()
        migration_ok = self.verify_file_migration()
        paths_ok = self.verify_path_references()
        docs_ok = self.verify_documentation()
        
        # ì „ì²´ ê²°ê³¼ íŒì •
        overall_success = folder_ok and migration_ok and paths_ok and docs_ok
        
print("/n"_+_" = " * 50)
        print("ê²€ì¦ ê²°ê³¼ ìš”ì•½:")
        print(f"í´ë” êµ¬ì¡°: {'âœ… PASS' if folder_ok else 'âŒ FAIL'}")
        print(f"íŒŒì¼ ì´ë™: {'âœ… PASS' if migration_ok else 'âŒ FAIL'}")
        print(f"ê²½ë¡œ ì°¸ì¡°: {'âœ… PASS' if paths_ok else 'âŒ FAIL'}")
        print(f"ë¬¸ì„œí™”: {'âœ… PASS' if docs_ok else 'âŒ FAIL'}")
        print(f"/nì „ì²´ ê²°ê³¼: {'âœ… ì„±ê³µ' if overall_success else 'âŒ ì‹¤íŒ¨'}")
        
        # ê²°ê³¼ ì €ì¥
        self.verification_results["overall_status"] = "success" if overall_success else "failed"
        self._save_verification_results()
        
        return overall_success
    
    def _save_verification_results(self):
        """ê²€ì¦ ê²°ê³¼ ì €ì¥"""
        try:
            with open("folder_reorganization_verification.json", 'w', encoding='utf-8') as f:
                json.dump(self.verification_results, f, indent=2, ensure_ascii=False)
            print(f"/nê²€ì¦ ê²°ê³¼ê°€ folder_reorganization_verification.jsonì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
        except Exception as e:
            print(f"ê²€ì¦ ê²°ê³¼ ì €ì¥ ì‹¤íŒ¨: {e}")

def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
    verifier = FolderReorganizationVerifier()
    success = verifier.run_verification()
    
    if success:
        print("/nğŸ‰ í´ë” êµ¬ì¡° ì¬êµ¬ì„±ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!")
    else:
        print("/nâš ï¸  ì¼ë¶€ ê²€ì¦ í•­ëª©ì—ì„œ ë¬¸ì œê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.")
    
    return success

if __name__ == "__main__":
    main()