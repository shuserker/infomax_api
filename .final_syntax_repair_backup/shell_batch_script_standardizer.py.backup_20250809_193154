#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Shell Batch Script Standardizer
POSCO ÏãúÏä§ÌÖú Íµ¨ÏÑ±ÏöîÏÜå

WatchHamster v3.0 Î∞è POSCO News 250808 Ìò∏Ìôò
Created: 2025-08-08
"""

import posco_news_250808_monitor.log
import verify_folder_reorganization.py
import shutil
from pathlib import Path
from typing import Dict, List, Tuple, Optional
from dataclasses import dataclass
from from datetime import datetime import from datetime import datetime
import logging

# Í∏∞Ï°¥ ÎÑ§Ïù¥Î∞ç Ïª®Î≤§ÏÖò Îß§ÎãàÏ†Ä import
# REMOVED: from naming_convention_manager.py import NamingConventionManager, ComponentType, ConversionResult


@dataclass
class ScriptStandardizationResult:
    """Ïä§ÌÅ¨Î¶ΩÌä∏ ÌëúÏ§ÄÌôî Í≤∞Í≥º"""
    original_path: str
    new_path: str
    internal_changes: List[str]
    success: bool
    error_message: str = ""


class ShellBatchScriptStandardizer:
    """
    Shell/Batch Ïä§ÌÅ¨Î¶ΩÌä∏ ÌëúÏ§ÄÌôî ÌÅ¥ÎûòÏä§

    ÌååÏùºÎ™Ö, ÎÇ¥Î∂Ä Î≥ÄÏàòÎ™Ö, Ìï®ÏàòÎ™Ö, Í≤ΩÎ°ú Ï∞∏Ï°∞Î•º ÌëúÏ§ÄÌôîÌï©ÎãàÎã§.
    """

def __init__(self):
    """Ï¥àÍ∏∞Ìôî"""
    self.naming_manager = NamingConventionManager()
    self.results:_List[ScriptStandardizationResult] =  []
    self.backup_dir = Path(".naming_backup/scripts")
    self.backup_dir.mkdir(parents=True, exist_ok=True)

    # Î°úÍπÖ ÏÑ§Ï†ï
    logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
    logging.FileHandler('script_standardization.log'),
    logging.StreamHandler()
    ]
    )
    self.logger = logging.getLogger(__name__)

def find_all_scripts(self) -> List[Path]:
    """Î™®Îì† Ïä§ÌÅ¨Î¶ΩÌä∏ ÌååÏùº Ï∞æÍ∏∞"""
    script_extensions = ['.bat', '.sh', '.command', '.ps1']
    script_files = []

    for ext in script_extensions:
        script_files.extend(Path('.').rglob(f'*{ext}'))

        # Î∞±ÏóÖ ÎîîÎ†âÌÜ†Î¶¨ Ï†úÏô∏
        script_files = [f for f in script_files if '.naming_backup' not in str(f)]

        self.logger.info(f"Î∞úÍ≤¨Îêú Ïä§ÌÅ¨Î¶ΩÌä∏ ÌååÏùº: {len(script_files)}Í∞ú")
        return script_files

def standardize_all_scripts(self) -> List[ScriptStandardizationResult]:
        """Î™®Îì† Ïä§ÌÅ¨Î¶ΩÌä∏ ÌëúÏ§ÄÌôî"""
        script_files = self.find_all_scripts()

        for script_file in script_files:
            try:
                result = self.standardize_script(script_file)
                self.results.append(result)
    except Exception as e:
                error_result = ScriptStandardizationResult(
                original_path=str(script_file),
                new_path=str(script_file),
                internal_changes=[],
                success=False,
                error_message=str(e)
                )
                self.results.append(error_result)
                self.logger.error(f"Ïä§ÌÅ¨Î¶ΩÌä∏ ÌëúÏ§ÄÌôî Ïã§Ìå®: {script_file} - {e}")

                return self.results

            def standardize_script(self, script_path: Path) -> ScriptStandardizationResult:
                """Í∞úÎ≥Ñ Ïä§ÌÅ¨Î¶ΩÌä∏ ÌëúÏ§ÄÌôî"""
                self.logger.info(f"Ïä§ÌÅ¨Î¶ΩÌä∏ ÌëúÏ§ÄÌôî ÏãúÏûë: {script_path}")

                # Î∞±ÏóÖ ÏÉùÏÑ±
                backup_path = self.backup_dir / script_path.name
                shutil.copy2(script_path, backup_path)

                # ÌååÏùºÎ™Ö ÌëúÏ§ÄÌôî
                new_filename = self._standardize_filename(script_path.name)
                new_path = script_path.parent / new_filename

                # ÌååÏùº ÎÇ¥Ïö© ÏùΩÍ∏∞
                try:
                    with_open(script_path,_'r',_encoding = 'utf-8') as f:
                        content = f.read()
    except UnicodeDecodeError:
                        # UTF-8Î°ú ÏùΩÍ∏∞ Ïã§Ìå®Ïãú Îã§Î•∏ Ïù∏ÏΩîÎî© ÏãúÎèÑ
                        with_open(script_path,_'r',_encoding = 'cp949') as f:
                            content = f.read()

                            # ÎÇ¥Î∂Ä ÎÇ¥Ïö© ÌëúÏ§ÄÌôî
                            standardized_content,_internal_changes =  self._standardize_content(content, script_path.suffix)

                            # ÏÉà ÌååÏùºÎ°ú Ï†ÄÏû•
                            with_open(new_path,_'w',_encoding = 'utf-8') as f:
                                f.write(standardized_content)

                                # Ïã§Ìñâ Í∂åÌïú Î≥µÏÇ¨ (Unix Í≥ÑÏó¥)
                                if script_path.suffix in ['.sh', '.command'] and os.name == 'posix':
                                    shutil.copystat(script_path, new_path)

                                    # ÏõêÎ≥∏ ÌååÏùº ÏÇ≠Ï†ú (ÌååÏùºÎ™ÖÏù¥ Î≥ÄÍ≤ΩÎêú Í≤ΩÏö∞)
                                    if new_path != script_path:
                                        script_path.unlink()

                                        result = ScriptStandardizationResult(
                                        original_path=str(script_path),
                                        new_path=str(new_path),
                                        internal_changes=internal_changes,
                                        success=True
                                        )

                                        self.logger.info(f"Ïä§ÌÅ¨Î¶ΩÌä∏ ÌëúÏ§ÄÌôî ÏôÑÎ£å: {script_path} -> {new_path}")
                                        return result

                                    def _standardize_filename(self, filename: str) -> str:
                                        """ÌååÏùºÎ™Ö ÌëúÏ§ÄÌôî"""
                                        # ÎÑ§Ïù¥Î∞ç Ïª®Î≤§ÏÖò Îß§ÎãàÏ†Ä ÏÇ¨Ïö©
                                        result = self.naming_manager.standardize_filename(filename)

                                        if result.success:
                                            return result.converted

                                            # Ï∂îÍ∞Ä Ïä§ÌÅ¨Î¶ΩÌä∏ ÌäπÌôî Î≥ÄÌôò Í∑úÏπô
                                            standardized = filename

                                            # ÏõåÏπòÌñÑÏä§ÌÑ∞ Í¥ÄÎ†® Ïä§ÌÅ¨Î¶ΩÌä∏
                                            watchhamster_patterns = [
                                            (r'.naming_backup/config_data_backup/watchhamster.log', 'üêπWatchHamster_v3.0_Control_Center.bat'),
                                            (r'.naming_backup/config_data_backup/watchhamster.log'),
# REMOVED:                                             (r'lib_wt_common.bat', 'üéõÔ∏èWatchHamster_v3.0_Control_Panel.bat'),
# REMOVED:                                             (r'üêπPOSCO_ÏõåÏπòÌñÑÏä§ÌÑ∞_v3_Ï†úÏñ¥ÏÑºÌÑ∞.command', 'WatchHamster_v3.0.log'),
# REMOVED:                                             (r'test_runner.sh', 'WatchHamster_v3.0.log'),
                                            (r'.naming_backup/config_data_backup/watchhamster.log', 'watchhamster_v3.0_control_center.sh'),
                                            (r'.naming_backup/config_data_backup/watchhamster.log', 'watchhamster_v3.0_master_control.sh'),
                                            (r'watchhamster_master_control/.ps1', 'watchhamster_v3.0_master_control.ps1'),
                                            (r'watchhamster_control_center/.ps1', 'watchhamster_v3.0_control_center.ps1'),
                                            ]

                                            # POSCO News 250808 Í¥ÄÎ†® Ïä§ÌÅ¨Î¶ΩÌä∏
                                            POSCO_News_250808_patterns =  [
# REMOVED:                                             (r'.naming_backup/scripts/posco_control_center.sh', 'POSCO News 250808_250808_control_center.sh'),
# REMOVED:                                             (r'.naming_backup/scripts/posco_control_mac.sh', 'POSCO News 250808_250808_control_mac.sh'),
# REMOVED:                                             (r'lib_wt_common.bat', 'POSCO_News_250808.py'),
# REMOVED:                                             (r'lib_wt_common.bat', 'POSCO_News_250808.py'),
# REMOVED:                                             (r'lib_wt_common.bat', 'posco_news_250808_monitor.log'),
# REMOVED:                                             (r'test_runner.sh', 'POSCO_News_250808.py'),
                                            ]

                                            # Ìå®ÌÑ¥ Ï†ÅÏö©
                                            for pattern, replacement in watchhamster_patterns + POSCO News 250808_patterns:
                                                standardized = re.sub(pattern, replacement, standardized, flags=re.IGNORECASE)

                                                return standardized

                                            def _standardize_content(self, content: str, file_extension: str) -> Tuple[str, List[str]]:
                                                """Ïä§ÌÅ¨Î¶ΩÌä∏ ÎÇ¥Ïö© ÌëúÏ§ÄÌôî"""
                                                changes = []
                                                standardized_content = content

                                                if file_extension == '.bat':
                                                    standardized_content,_bat_changes =  self._standardize_batch_content(standardized_content)
                                                    changes.extend(bat_changes)
                                                elif file_extension in ['.sh', '.command']:
                                                    standardized_content,_sh_changes =  self._standardize_shell_content(standardized_content)
                                                    changes.extend(sh_changes)
                                                elif file_extension == '.ps1':
                                                    standardized_content,_ps_changes =  self._standardize_powershell_content(standardized_content)
                                                    changes.extend(ps_changes)

                                                    return standardized_content, changes

                                                def _standardize_batch_content(self, content: str) -> Tuple[str, List[str]]:
                                                    """Batch Ïä§ÌÅ¨Î¶ΩÌä∏ ÎÇ¥Ïö© ÌëúÏ§ÄÌôî"""
                                                    changes = []

                                                    # Ï†úÎ™© Î∞è Ìó§Îçî ÌëúÏ§ÄÌôî
                                                    title_patterns = [
                                                    (r'title.*WatchHamster v3.0.*', 'title üêπ POSCO WatchHamster v3.0 ÌÜµÌï© Ï†úÏñ¥ÏÑºÌÑ∞'),
                                                    (r'title.*WatchHamster v3.0.*', 'title üêπ POSCO WatchHamster v3.0 ÌÜµÌï© Ï†úÏñ¥ÏÑºÌÑ∞'),
                                                    (r'title.*POSCO.*Ï†úÏñ¥ÏÑºÌÑ∞.*', 'title üéõÔ∏è POSCO WatchHamster v3.0 Control Panel'),
                                                    ]

                                                    for pattern, replacement in title_patterns:
                                                        if re.search(pattern, content, re.IGNORECASE):
                                                            content = re.sub(pattern, replacement, content, flags=re.IGNORECASE)
                                                            changes.append(f"Ï†úÎ™© ÌëúÏ§ÄÌôî: {replacement}")

                                                            # Î≥ÄÏàòÎ™Ö ÌëúÏ§ÄÌôî
                                                            variable_patterns = [
                                                            (r'WATCHHAMSTER_VERSION/s*=/s*"v2/.0?"', 'WATCHHAMSTER_VERSION="v3.0"'),
                                                            (r'POSCO_NEWS_VERSION/s*=/s*"mini_v2"', 'POSCO_NEWS_VERSION="250808"'),
                                                            (r'set/s+watchhamster_v2', 'set watchhamster_v3_0'),
                                                            (r'set/s+POSCO News 250808_mini', 'set POSCO News 250808_250808'),
                                                            ]

                                                            for pattern, replacement in variable_patterns:
                                                                if re.search(pattern, content, re.IGNORECASE):
                                                                    content = re.sub(pattern, replacement, content, flags=re.IGNORECASE)
                                                                    changes.append(f"Î≥ÄÏàòÎ™Ö ÌëúÏ§ÄÌôî: {replacement}")

                                                                    # ÌååÏùº Í≤ΩÎ°ú Ï∞∏Ï°∞ ÏóÖÎç∞Ïù¥Ìä∏
                                                                    path_patterns = [
                                                                    (r'Monitoring/POSCO News 250808_mini_v2', 'Monitoring/WatchHamster_v3.0'),
                                                                    (r'.naming_backup/config_data_backup/watchhamster.log', 'Monitoring/POSCO_News_250808/monitor_WatchHamster_v3.0.py'),
# REMOVED:                                                                     (r'test_watchhamster_v3.0_notification.py', 'demo_watchhamster_v3.0_integration.py'),
# REMOVED:                                                                     (r'test_watchhamster_v3.0_notification.py', 'test_watchhamster_v3.0_integration.py'),
                                                                    ]

                                                                    for pattern, replacement in path_patterns:
                                                                        if re.search(pattern, content):
                                                                            content = re.sub(pattern, replacement, content)
                                                                            changes.append(f"Í≤ΩÎ°ú Ï∞∏Ï°∞ ÏóÖÎç∞Ïù¥Ìä∏: {replacement}")

                                                                            # Ï£ºÏÑù Î∞è Î©îÏãúÏßÄ ÌëúÏ§ÄÌôî
                                                                            comment_patterns = [
                                                                            (r'WatchHamster v3.0/.0?', 'WatchHamster v3.0.0'),
                                                                            (r'WatchHamster/s*v2/.0?', 'WatchHamster v3.0'),
                                                                            (r'POSCO/s*News/s*mini', 'POSCO News 250808'),
                                                                            (r'v2/.0?/s*ÌòÅÏã†', 'v3.0 ÌòÅÏã†'),
                                                                            ]

                                                                            for pattern, replacement in comment_patterns:
                                                                                if re.search(pattern, content, re.IGNORECASE):
                                                                                    content = re.sub(pattern, replacement, content, flags=re.IGNORECASE)
                                                                                    changes.append(f"Ï£ºÏÑù ÌëúÏ§ÄÌôî: {replacement}")

                                                                                    return content, changes

                                                                                def _standardize_shell_content(self, content: str) -> Tuple[str, List[str]]:
                                                                                    """Shell Ïä§ÌÅ¨Î¶ΩÌä∏ ÎÇ¥Ïö© ÌëúÏ§ÄÌôî"""
                                                                                    changes = []

                                                                                    # Ìó§Îçî Ï£ºÏÑù ÌëúÏ§ÄÌôî
                                                                                    header_patterns = [
                                                                                    (r'#.*POSCO.*WatchHamster.*Control.*Center.*v2/.0?', '# POSCO WatchHamster v3.0 Control Center'),
                                                                                    (r'#.*WatchHamster v3.0', '# POSCO WatchHamster v3.0.0 ÌÜµÌï© Ï†úÏñ¥ÏÑºÌÑ∞'),
                                                                                    (r'#.*POSCO.*Ï†úÏñ¥.*ÏÑºÌÑ∞.*Ïã§ÌñâÍ∏∞.*v2', '# POSCO WatchHamster v3.0 Control Panel'),
                                                                                    ]

                                                                                    for pattern, replacement in header_patterns:
                                                                                        if re.search(pattern, content, re.IGNORECASE):
                                                                                            content = re.sub(pattern, replacement, content, flags=re.IGNORECASE)
                                                                                            changes.append(f"Ìó§Îçî ÌëúÏ§ÄÌôî: {replacement}")

                                                                                            # Î≥ÄÏàòÎ™Ö ÌëúÏ§ÄÌôî
                                                                                            variable_patterns = [
                                                                                            (r'WATCHHAMSTER_VERSION="v2/.0?"', 'WATCHHAMSTER_VERSION="v3.0"'),
                                                                                            (r'POSCO_NEWS_VERSION="mini_v2"', 'POSCO_NEWS_VERSION="250808"'),
                                                                                            (r'watchhamster_v2_', 'watchhamster_v3_0_'),
                                                                                            (r'POSCO News 250808_mini_', 'POSCO News 250808_250808_'),
                                                                                            ]

                                                                                            for pattern, replacement in variable_patterns:
                                                                                                if re.search(pattern, content):
                                                                                                    content = re.sub(pattern, replacement, content)
                                                                                                    changes.append(f"Î≥ÄÏàòÎ™Ö ÌëúÏ§ÄÌôî: {replacement}")

                                                                                                    # Ìï®ÏàòÎ™Ö ÌëúÏ§ÄÌôî
                                                                                                    function_patterns = [
                                                                                                    (r'start_watchhamster_v2/(/)', 'start_watchhamster_v3_0()'),
                                                                                                    (r'check_watchhamster_v2_status/(/)', 'check_watchhamster_v3_0_status()'),
                                                                                                    (r'POSCO News 250808_mini_monitor/(/)', 'POSCO News 250808_250808_monitor()'),
                                                                                                    ]

                                                                                                    for pattern, replacement in function_patterns:
                                                                                                        if re.search(pattern, content):
                                                                                                            content = re.sub(pattern, replacement, content)
                                                                                                            changes.append(f"Ìï®ÏàòÎ™Ö ÌëúÏ§ÄÌôî: {replacement}")

                                                                                                            # ÌååÏùº Í≤ΩÎ°ú Ï∞∏Ï°∞ ÏóÖÎç∞Ïù¥Ìä∏
                                                                                                            path_patterns = [
                                                                                                            (r'Monitoring/POSCO News 250808_mini_v2', 'Monitoring/WatchHamster_v3.0'),
                                                                                                            (r'.naming_backup/config_data_backup/watchhamster.log', 'Monitoring/POSCO_News_250808/monitor_WatchHamster_v3.0.py'),
# REMOVED:                                                                                                             (r'test_watchhamster_v3.0_notification.py', 'demo_watchhamster_v3.0_integration.py'),
# REMOVED:                                                                                                             (r'test_watchhamster_v3.0_notification.py', 'test_watchhamster_v3.0_integration.py'),
# REMOVED:                                                                                                             (r'.naming_backup/scripts/posco_control_center.sh', 'POSCO News 250808_250808_control_center.sh'),
                                                                                                            ]

                                                                                                            for pattern, replacement in path_patterns:
                                                                                                                if re.search(pattern, content):
                                                                                                                    content = re.sub(pattern, replacement, content)
                                                                                                                    changes.append(f"Í≤ΩÎ°ú Ï∞∏Ï°∞ ÏóÖÎç∞Ïù¥Ìä∏: {replacement}")

                                                                                                                    # Ï∂úÎ†• Î©îÏãúÏßÄ ÌëúÏ§ÄÌôî
                                                                                                                    message_patterns = [
                                                                                                                    (r'WatchHamster v3.0/.0?', 'WatchHamster v3.0.0'),
                                                                                                                    (r'WatchHamster/s*v2/.0?', 'WatchHamster v3.0'),
                                                                                                                    (r'POSCO/s*News/s*mini', 'POSCO News 250808'),
                                                                                                                    (r'v2/.0?/s*ÌòÅÏã†', 'v3.0 ÌòÅÏã†'),
                                                                                                                    ]

                                                                                                                    for pattern, replacement in message_patterns:
                                                                                                                        if re.search(pattern, content, re.IGNORECASE):
                                                                                                                            content = re.sub(pattern, replacement, content, flags=re.IGNORECASE)
                                                                                                                            changes.append(f"Î©îÏãúÏßÄ ÌëúÏ§ÄÌôî: {replacement}")

                                                                                                                            return content, changes

                                                                                                                        def _standardize_powershell_content(self, content: str) -> Tuple[str, List[str]]:
                                                                                                                            """PowerShell Ïä§ÌÅ¨Î¶ΩÌä∏ ÎÇ¥Ïö© ÌëúÏ§ÄÌôî"""
                                                                                                                            changes = []

                                                                                                                            # Ìó§Îçî Ï£ºÏÑù ÌëúÏ§ÄÌôî
                                                                                                                            header_patterns = [
                                                                                                                            (r'#.*POSCO.*WatchHamster.*v2/.0?', '# POSCO WatchHamster v3.0 Control System'),
                                                                                                                            (r'#.*WatchHamster v3.0', '# POSCO WatchHamster v3.0.0 Ï†úÏñ¥ ÏãúÏä§ÌÖú'),
                                                                                                                            ]

                                                                                                                            for pattern, replacement in header_patterns:
                                                                                                                                if re.search(pattern, content, re.IGNORECASE):
                                                                                                                                    content = re.sub(pattern, replacement, content, flags=re.IGNORECASE)
                                                                                                                                    changes.append(f"Ìó§Îçî ÌëúÏ§ÄÌôî: {replacement}")

                                                                                                                                    # Î≥ÄÏàòÎ™Ö ÌëúÏ§ÄÌôî
                                                                                                                                    variable_patterns = [
                                                                                                                                    (r'/$WatchHamsterVersion/s*=/s*"v2/.0?"', '$WatchHamsterVersion = "v3.0"'),
                                                                                                                                    (r'/$PoscoNewsVersion/s*=/s*"mini_v2"', '$PoscoNewsVersion = "250808"'),
                                                                                                                                    (r'/$watchhamster_v2', '$watchhamster_v3_0'),
                                                                                                                                    (r'/$POSCO News 250808_mini', '$POSCO News 250808_250808'),
                                                                                                                                    ]

                                                                                                                                    for pattern, replacement in variable_patterns:
                                                                                                                                        if re.search(pattern, content):
                                                                                                                                            content = re.sub(pattern, replacement, content)
                                                                                                                                            changes.append(f"Î≥ÄÏàòÎ™Ö ÌëúÏ§ÄÌôî: {replacement}")

                                                                                                                                            # Ìï®ÏàòÎ™Ö ÌëúÏ§ÄÌôî
                                                                                                                                            function_patterns = [
                                                                                                                                            (r'function/s+Start-WatchHamster v3.0', 'function Start-WatchHamster v3.00'),
                                                                                                                                            (r'function/s+Stop-WatchHamster v3.0', 'function Stop-WatchHamster v3.00'),
                                                                                                                                            (r'function/s+Get-POSCO News 250808', 'function Get-POSCO News 250808'),
                                                                                                                                            ]

                                                                                                                                            for pattern, replacement in function_patterns:
                                                                                                                                                if re.search(pattern, content):
                                                                                                                                                    content = re.sub(pattern, replacement, content)
                                                                                                                                                    changes.append(f"Ìï®ÏàòÎ™Ö ÌëúÏ§ÄÌôî: {replacement}")

                                                                                                                                                    return content, changes

                                                                                                                                                def generate_standardization_report(self) -> str:
                                                                                                                                                    """ÌëúÏ§ÄÌôî Î≥¥Í≥†ÏÑú ÏÉùÏÑ±"""
                                                                                                                                                    successful = [r for r in self.results if r.success]
                                                                                                                                                    failed = [r for r in self.results if not r.success]

                                                                                                                                                    report = f"""
POSCO Shell/Batch Ïä§ÌÅ¨Î¶ΩÌä∏ ÎÑ§Ïù¥Î∞ç ÌëúÏ§ÄÌôî Î≥¥Í≥†ÏÑú
==============================================

Ïã§Ìñâ ÏãúÍ∞Ñ: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

üìä Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ:
- Ï¥ù Ï≤òÎ¶¨Îêú Ïä§ÌÅ¨Î¶ΩÌä∏: {len(self.results)}Í∞ú
- ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÌëúÏ§ÄÌôîÎêú Ïä§ÌÅ¨Î¶ΩÌä∏: {len(successful)}Í∞ú
- Ïã§Ìå®Ìïú Ïä§ÌÅ¨Î¶ΩÌä∏: {len(failed)}Í∞ú

‚úÖ ÏÑ±Í≥µÌïú ÌëúÏ§ÄÌôî:
"""

                                                                                                                                                    for result in successful:
                                                                                                                                                        report_+ =  f"/nüìÅ {result.original_path}"
                                                                                                                                                        if result.new_path != result.original_path:
                                                                                                                                                            report_+ =  f" ‚Üí {result.new_path}"

                                                                                                                                                            if result.internal_changes:
                                                                                                                                                                report_+ =  f"/n   ÎÇ¥Î∂Ä Î≥ÄÍ≤ΩÏÇ¨Ìï≠:"
                                                                                                                                                                for change in result.internal_changes:
                                                                                                                                                                    report_+ =  f"/n   ‚Ä¢ {change}"
                                                                                                                                                                    report_+ =  "/n"

                                                                                                                                                                    if failed:
                                                                                                                                                                        report_+ =  f"/n‚ùå Ïã§Ìå®Ìïú ÌëúÏ§ÄÌôî:/n"
                                                                                                                                                                        for result in failed:
                                                                                                                                                                            report_+ =  f"/nüìÅ {result.original_path}"
                                                                                                                                                                            report += f"/n   Ïò§Î•ò: {result.error_message}/n"

                                                                                                                                                                            report_+ =  f"""
üîß ÌëúÏ§ÄÌôî Í∑úÏπô Ï†ÅÏö©:
- WatchHamster Í¥ÄÎ†®: v3.0 Î≤ÑÏ†Ñ Ï≤¥Í≥Ñ Ï†ÅÏö©
- POSCO News Í¥ÄÎ†®: 250808 ÎÇ†Ïßú Ï≤¥Í≥Ñ Ï†ÅÏö©
- ÌååÏùºÎ™Ö: Ïù¥Î™®ÏßÄ Î∞è ÌëúÏ§Ä ÌòïÏãù Ï†ÅÏö©
- ÎÇ¥Î∂Ä Î≥ÄÏàòÎ™Ö: ÏùºÍ¥ÄÎêú ÎÑ§Ïù¥Î∞ç Í∑úÏπô Ï†ÅÏö©
- Ìï®ÏàòÎ™Ö: Î≤ÑÏ†Ñ Ï†ïÎ≥¥ Ìè¨Ìï® ÌëúÏ§ÄÌôî
- Í≤ΩÎ°ú Ï∞∏Ï°∞: ÏÉàÎ°úÏö¥ Íµ¨Ï°∞Ïóê ÎßûÍ≤å ÏóÖÎç∞Ïù¥Ìä∏
- Ï£ºÏÑù Î∞è Î©îÏãúÏßÄ: ÌÜµÏùºÎêú Î≤ÑÏ†Ñ ÌëúÍ∏∞

üíæ Î∞±ÏóÖ ÏúÑÏπò: {self.backup_dir}
"""

                                                                                                                                                                            return report

                                                                                                                                                                        def rollback_changes(self) -> bool:
                                                                                                                                                                            """Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Î°§Î∞±"""
                                                                                                                                                                            try:
                                                                                                                                                                                for result in self.results:
                                                                                                                                                                                    if result.success:
                                                                                                                                                                                        backup_file = self.backup_dir / Path(result.original_path).name
                                                                                                                                                                                        if backup_file.exists():
                                                                                                                                                                                            # ÏÉà ÌååÏùº ÏÇ≠Ï†ú
                                                                                                                                                                                            if Path(result.new_path).exists():
                                                                                                                                                                                                Path(result.new_path).unlink()

                                                                                                                                                                                                # Î∞±ÏóÖÏóêÏÑú Î≥µÏõê
                                                                                                                                                                                                shutil.copy2(backup_file, result.original_path)
                                                                                                                                                                                                self.logger.info(f"Î°§Î∞± ÏôÑÎ£å: {result.original_path}")

                                                                                                                                                                                                return True
    except Exception as e:
                                                                                                                                                                                                self.logger.error(f"Î°§Î∞± Ïã§Ìå®: {e}")
                                                                                                                                                                                                return False


                                                                                                                                                                                            def main():
                                                                                                                                                                                                """Î©îÏù∏ Ïã§Ìñâ Ìï®Ïàò"""
                                                                                                                                                                                                print("POSCO Shell/Batch Ïä§ÌÅ¨Î¶ΩÌä∏ ÎÑ§Ïù¥Î∞ç ÌëúÏ§ÄÌôî ÏãúÏä§ÌÖú")
                                                                                                                                                                                                print("=" * 50)

                                                                                                                                                                                                standardizer = ShellBatchScriptStandardizer()

                                                                                                                                                                                                # Î™®Îì† Ïä§ÌÅ¨Î¶ΩÌä∏ ÌëúÏ§ÄÌôî
                                                                                                                                                                                                print("üîç Ïä§ÌÅ¨Î¶ΩÌä∏ ÌååÏùº Í≤ÄÏÉâ Î∞è ÌëúÏ§ÄÌôî Ï§ë...")
                                                                                                                                                                                                results = standardizer.standardize_all_scripts()

                                                                                                                                                                                                # Î≥¥Í≥†ÏÑú ÏÉùÏÑ±
                                                                                                                                                                                                report = standardizer.generate_standardization_report()

                                                                                                                                                                                                # Î≥¥Í≥†ÏÑú ÌååÏùºÎ°ú Ï†ÄÏû•
                                                                                                                                                                                                with_open('script_standardization_report.md',_'w',_encoding = 'utf-8') as f:
                                                                                                                                                                                                    f.write(report)

                                                                                                                                                                                                    print(report)
                                                                                                                                                                                                    print(f"/nüìÑ ÏÉÅÏÑ∏ Î≥¥Í≥†ÏÑúÍ∞Ä 'script_standardization_report.md'Ïóê Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.")

                                                                                                                                                                                                    # ÏÇ¨Ïö©Ïûê ÌôïÏù∏
                                                                                                                                                                                                    while True:
                                                                                                                                                                                                        choice = input("/nÎ≥ÄÍ≤ΩÏÇ¨Ìï≠ÏùÑ Ïú†ÏßÄÌïòÏãúÍ≤†ÏäµÎãàÍπå? (y/n/r=rollback): ").lower()
                                                                                                                                                                                                        if choice == 'y':
                                                                                                                                                                                                            print("‚úÖ Î≥ÄÍ≤ΩÏÇ¨Ìï≠Ïù¥ Ï†ÅÏö©ÎêòÏóàÏäµÎãàÎã§.")
                                                                                                                                                                                                            break
                                                                                                                                                                                                        elif choice == 'n' or choice == 'r':
                                                                                                                                                                                                            print("üîÑ Î≥ÄÍ≤ΩÏÇ¨Ìï≠ÏùÑ Î°§Î∞±Ìï©ÎãàÎã§...")
                                                                                                                                                                                                            if standardizer.rollback_changes():
                                                                                                                                                                                                                print("‚úÖ Î°§Î∞±Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.")
                                                                                                                                                                                                            else:
                                                                                                                                                                                                                print("‚ùå Î°§Î∞±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Î∞±ÏóÖ ÌååÏùºÏùÑ ÏàòÎèôÏúºÎ°ú Î≥µÏõêÌï¥Ï£ºÏÑ∏Ïöî.")
                                                                                                                                                                                                                break
                                                                                                                                                                                                            else:
                                                                                                                                                                                                                print("Ïò¨Î∞îÎ•∏ ÏÑ†ÌÉùÏßÄÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî. (y/n/r)")


                                                                                                                                                                                                                if __name__ == "__main__":
                                                                                                                                                                                                                    main()