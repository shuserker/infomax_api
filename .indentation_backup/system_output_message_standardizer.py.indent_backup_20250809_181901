#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
System Output Message Standardizer
POSCO ì‹œìŠ¤í…œ ì¶œë ¥ ë©”ì‹œì§€ í‘œì¤€í™” ë„êµ¬

WatchHamster v3.0 ë° POSCO News 250808 í˜¸í™˜
Created: 2025-08-08
"""

import os
import re
import json
from pathlib import Path
from typing import Dict, List, Tuple, Set
from datetime import datetime

class SystemOutputMessageStandardizer:
    """
    ì‹œìŠ¤í…œ ì¶œë ¥ ë©”ì‹œì§€ í‘œì¤€í™” í´ë˜ìŠ¤
    
    ëª¨ë“  Python, Shell, Batch íŒŒì¼ì˜ ì¶œë ¥ ë©”ì‹œì§€ë¥¼ í‘œì¤€í™”í•©ë‹ˆë‹¤.
    - ì‹œì‘/ì¢…ë£Œ ë©”ì‹œì§€ì˜ ë²„ì „ ì •ë³´ í‘œì¤€í™”
    - ë¡œê·¸ ë©”ì‹œì§€ì˜ ì œí’ˆëª… ë° ë²„ì „ í‘œê¸° í†µì¼
    - ì—ëŸ¬ ë©”ì‹œì§€ ë° ì•Œë¦¼ ë©”ì‹œì§€ í‘œì¤€í™”
    - ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ í…ìŠ¤íŠ¸ í‘œì¤€í™”
    """
    
    def __init__(self, workspace_root: str = "."):
        """
        ì‹œìŠ¤í…œ ì¶œë ¥ ë©”ì‹œì§€ í‘œì¤€í™” ë„êµ¬ ì´ˆê¸°í™”
        
        Args:
            workspace_root (str): ì‘ì—… ê³µê°„ ë£¨íŠ¸ ë””ë ‰í† ë¦¬
        """
        self.workspace_root = Path(workspace_root)
        
        # ë²„ì „ ì •ë³´ í‘œì¤€í™” ê·œì¹™
        self.version_standards = {
            'watchhamster': {
                'version': 'v3.0',
                'display_name': 'WatchHamster v3.0',
                'product_name': 'POSCO WatchHamster',
                'system_name': 'ì›Œì¹˜í–„ìŠ¤í„° v3.0'
            },
            'posco_news': {
                'version': '250808',
                'display_name': 'POSCO News 250808',
                'product_name': 'POSCO ë‰´ìŠ¤',
                'system_name': 'í¬ìŠ¤ì½” ë‰´ìŠ¤ 250808'
            }
        }
        
        # ë©”ì‹œì§€ í‘œì¤€í™” íŒ¨í„´ - ê°„ë‹¨í•œ ë¬¸ìì—´ êµì²´ ë°©ì‹ ì‚¬ìš©
        self.message_replacements = [
            # ì›Œì¹˜í–„ìŠ¤í„° ë²„ì „ í‘œì¤€í™”
            ('ì›Œì¹˜í–„ìŠ¤í„° v2', 'WatchHamster v3.0'),
            ('ì›Œì¹˜í–„ìŠ¤í„° v3', 'WatchHamster v3.0'),
            ('ì›Œì¹˜í–„ìŠ¤í„° ë²„ì „ v2', 'WatchHamster v3.0'),
            ('ì›Œì¹˜í–„ìŠ¤í„° ë²„ì „ v3', 'WatchHamster v3.0'),
            ('POSCO ì›Œì¹˜í–„ìŠ¤í„°', 'POSCO WatchHamster v3.0'),
            ('í¬ìŠ¤ì½” ì›Œì¹˜í–„ìŠ¤í„°', 'POSCO WatchHamster v3.0'),
            ('ì›Œì¹˜í–„ìŠ¤í„° ì—°ê²°', 'WatchHamster v3.0'),
            
            # í¬ìŠ¤ì½” ë‰´ìŠ¤ ë²„ì „ í‘œì¤€í™”
            ('í¬ìŠ¤ì½” ë‰´ìŠ¤', 'POSCO News 250808'),
            ('Posco News', 'POSCO News 250808'),
            ('posco news', 'POSCO News 250808'),
            ('POSCO ë‰´ìŠ¤', 'POSCO News 250808'),
            ('Posco News mini', 'POSCO News 250808'),
            ('í¬ìŠ¤ì½” ë‰´ìŠ¤ ëª¨ë‹ˆí„°ë§', 'POSCO News 250808'),
            
            # ì‹œì‘/ì¢…ë£Œ ë©”ì‹œì§€
            ('ì›Œì¹˜í–„ìŠ¤í„° ì´ˆê¸°í™”', 'WatchHamster v3.0 ì´ˆê¸°í™”'),
            ('ì›Œì¹˜í–„ìŠ¤í„° ì‹œì‘', 'WatchHamster v3.0 ì‹œì‘'),
            ('í¬ìŠ¤ì½” ë‰´ìŠ¤ ì‹œì‘', 'POSCO News 250808 ì‹œì‘'),
            
            # ì—ëŸ¬ ë©”ì‹œì§€
            ('ì›Œì¹˜í–„ìŠ¤í„° ì˜¤ë¥˜', 'WatchHamster v3.0 ì˜¤ë¥˜'),
            ('ì›Œì¹˜í–„ìŠ¤í„° ì‹¤íŒ¨', 'WatchHamster v3.0 ì‹¤íŒ¨'),
            ('í¬ìŠ¤ì½” ë‰´ìŠ¤ ì˜¤ë¥˜', 'POSCO News 250808 ì˜¤ë¥˜'),
            ('í¬ìŠ¤ì½” ë‰´ìŠ¤ ì‹¤íŒ¨', 'POSCO News 250808 ì‹¤íŒ¨'),
            
            # ì•Œë¦¼ ë©”ì‹œì§€
            ('ì›Œì¹˜í–„ìŠ¤í„° ì•Œë¦¼', 'WatchHamster v3.0 ì•Œë¦¼'),
            ('í¬ìŠ¤ì½” ë‰´ìŠ¤ ì•Œë¦¼', 'POSCO News 250808 ì•Œë¦¼'),
            ('POSCO ë‰´ìŠ¤ ì•Œë¦¼', 'POSCO News 250808 ì•Œë¦¼'),
            ('í¬ìŠ¤ì½” ì›Œì¹˜í–„ìŠ¤í„° ì•Œë¦¼', 'POSCO WatchHamster v3.0 ì•Œë¦¼'),
            
            # ìƒíƒœ ë©”ì‹œì§€
            ('ì›Œì¹˜í–„ìŠ¤í„° ìƒíƒœ', 'WatchHamster v3.0 ìƒíƒœ'),
            ('í¬ìŠ¤ì½” ë‰´ìŠ¤ ìƒíƒœ', 'POSCO News 250808 ìƒíƒœ'),
        ]
        
        # ë³€ê²½ ì‚¬í•­ ì¶”ì 
        self.changes_made = []
        
        # ì œì™¸í•  íŒŒì¼ íŒ¨í„´
        self.exclude_patterns = {
            '*.pyc', '__pycache__', '.git', '.DS_Store', 
            'node_modules', '.vscode', '.idea',
            '*.log', '*.json', '*.md', '*.txt', '*.html'
        }
        
        print("ğŸ”§ ì‹œìŠ¤í…œ ì¶œë ¥ ë©”ì‹œì§€ í‘œì¤€í™” ë„êµ¬ ì´ˆê¸°í™” ì™„ë£Œ")
        print(f"ğŸ“ ì‘ì—… ë””ë ‰í† ë¦¬: {self.workspace_root.absolute()}")
    
    def find_target_files(self) -> List[Path]:
        """
        í‘œì¤€í™” ëŒ€ìƒ íŒŒì¼ ëª©ë¡ ì¡°íšŒ
        
        Returns:
            List[Path]: ëŒ€ìƒ íŒŒì¼ ê²½ë¡œ ëª©ë¡
        """
        target_files = []
        
        # Python íŒŒì¼
        python_files = list(self.workspace_root.rglob("*.py"))
        target_files.extend(python_files)
        
        # Shell ìŠ¤í¬ë¦½íŠ¸
        shell_files = list(self.workspace_root.rglob("*.sh"))
        target_files.extend(shell_files)
        
        # Batch íŒŒì¼
        batch_files = list(self.workspace_root.rglob("*.bat"))
        target_files.extend(batch_files)
        
        # PowerShell íŒŒì¼
        ps1_files = list(self.workspace_root.rglob("*.ps1"))
        target_files.extend(ps1_files)
        
        # ì œì™¸ íŒ¨í„´ í•„í„°ë§
        filtered_files = []
        for file_path in target_files:
            should_exclude = False
            for exclude_pattern in self.exclude_patterns:
                if exclude_pattern.replace('*', '') in str(file_path):
                    should_exclude = True
                    break
            
            if not should_exclude:
                filtered_files.append(file_path)
        
        print(f"ğŸ“‹ í‘œì¤€í™” ëŒ€ìƒ íŒŒì¼: {len(filtered_files)}ê°œ")
        return filtered_files
    
    def standardize_output_messages(self, file_path: Path) -> bool:
        """
        íŒŒì¼ì˜ ì¶œë ¥ ë©”ì‹œì§€ í‘œì¤€í™”
        
        Args:
            file_path (Path): ëŒ€ìƒ íŒŒì¼ ê²½ë¡œ
            
        Returns:
            bool: ë³€ê²½ ì—¬ë¶€
        """
        try:
            # íŒŒì¼ ì½ê¸°
with_open(file_path,_'r',_encoding = 'utf-8') as f:
                content = f.read()
            
            original_content = content
            changes_in_file = []
            
            # ê° êµì²´ ê·œì¹™ ì ìš©
            for old_text, new_text in self.message_replacements:
                if old_text in content:
                    content = content.replace(old_text, new_text)
                    changes_in_file.append(f"'{old_text}' â†’ '{new_text}'")
            
            # ë³€ê²½ì‚¬í•­ì´ ìˆìœ¼ë©´ íŒŒì¼ ì €ì¥
            if content != original_content:
with_open(file_path,_'w',_encoding = 'utf-8') as f:
                    f.write(content)
                
                # ë³€ê²½ì‚¬í•­ ê¸°ë¡
                self.changes_made.append({
                    'file': str(file_path.relative_to(self.workspace_root)),
                    'changes': changes_in_file
                })
                
                print(f"âœ… í‘œì¤€í™” ì™„ë£Œ: {file_path.relative_to(self.workspace_root)}")
                for change in changes_in_file:
                    print(f"   - {change}")
                
                return True
            else:
                return False
                
        except Exception as e:
            print(f"âŒ íŒŒì¼ ì²˜ë¦¬ ì‹¤íŒ¨ {file_path}: {e}")
            return False
    
    def run_standardization(self) -> Dict:
        """
        ì „ì²´ ì‹œìŠ¤í…œ ì¶œë ¥ ë©”ì‹œì§€ í‘œì¤€í™” ì‹¤í–‰
        
        Returns:
            Dict: ì‹¤í–‰ ê²°ê³¼ í†µê³„
        """
        print("ğŸš€ ì‹œìŠ¤í…œ ì¶œë ¥ ë©”ì‹œì§€ í‘œì¤€í™” ì‹œì‘")
        print("=" * 60)
        
        # ëŒ€ìƒ íŒŒì¼ ëª©ë¡ ì¡°íšŒ
        target_files = self.find_target_files()
        print(f"ğŸ“‹ ëŒ€ìƒ íŒŒì¼: {len(target_files)}ê°œ")
        
        # ê° íŒŒì¼ ì²˜ë¦¬
        processed_files = 0
        modified_files = 0
        
        for file_path in target_files:
            try:
                if self.standardize_output_messages(file_path):
                    modified_files += 1
processed_files_+ =  1
            except Exception as e:
                print(f"âŒ íŒŒì¼ ì²˜ë¦¬ ì‹¤íŒ¨ {file_path}: {e}")
        
        # ê²°ê³¼ í†µê³„
        result = {
            'total_files': len(target_files),
            'processed_files': processed_files,
            'modified_files': modified_files,
            'total_changes': sum(len(change['changes']) for change in self.changes_made)
        }
        
print("\n"_+_" = " * 60)
        print("ğŸ“Š ì‹œìŠ¤í…œ ì¶œë ¥ ë©”ì‹œì§€ í‘œì¤€í™” ê²°ê³¼")
        print("=" * 60)
        print(f"ì „ì²´ íŒŒì¼: {result['total_files']}ê°œ")
        print(f"ì²˜ë¦¬ëœ íŒŒì¼: {result['processed_files']}ê°œ")
        print(f"ìˆ˜ì •ëœ íŒŒì¼: {result['modified_files']}ê°œ")
        print(f"ì´ ë³€ê²½ì‚¬í•­: {result['total_changes']}ê°œ")
        
        if self.changes_made:
            print("\nğŸ“ ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡:")
            for change in self.changes_made:
                print(f"  â€¢ {change['file']} ({len(change['changes'])}ê°œ ë³€ê²½)")
        
        return result
    
    def generate_report(self, result: Dict) -> str:
        """
        í‘œì¤€í™” ê²°ê³¼ ë³´ê³ ì„œ ìƒì„±
        
        Args:
            result (Dict): ì‹¤í–‰ ê²°ê³¼ í†µê³„
            
        Returns:
            str: ë³´ê³ ì„œ ë‚´ìš©
        """
        report = f"""# ì‹œìŠ¤í…œ ì¶œë ¥ ë©”ì‹œì§€ í‘œì¤€í™” ë³´ê³ ì„œ

## ì‹¤í–‰ ì •ë³´
- ì‹¤í–‰ ì‹œê°„: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
- ì‘ì—… ë””ë ‰í† ë¦¬: {self.workspace_root.absolute()}

## ì²˜ë¦¬ ê²°ê³¼
- ì „ì²´ íŒŒì¼: {result['total_files']}ê°œ
- ì²˜ë¦¬ëœ íŒŒì¼: {result['processed_files']}ê°œ
- ìˆ˜ì •ëœ íŒŒì¼: {result['modified_files']}ê°œ
- ì´ ë³€ê²½ì‚¬í•­: {result['total_changes']}ê°œ

## í‘œì¤€í™” ê·œì¹™
### WatchHamster ë²„ì „ í‘œì¤€í™”
- ê¸°ì¡´: ì›Œì¹˜í–„ìŠ¤í„° v2, ì›Œì¹˜í–„ìŠ¤í„° v3
- í‘œì¤€: WatchHamster v3.0

### POSCO News ë²„ì „ í‘œì¤€í™”
- ê¸°ì¡´: í¬ìŠ¤ì½” ë‰´ìŠ¤, Posco News
- í‘œì¤€: POSCO News 250808

## ìˆ˜ì •ëœ íŒŒì¼ ìƒì„¸

"""
        
        if self.changes_made:
            for change in self.changes_made:
report_+ =  f"### {change['file']}\n"
                for change_detail in change['changes']:
report_+ =  f"- {change_detail}\n"
report_+ =  "\n"
        else:
report_+ =  "ìˆ˜ì •ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.\n"
        
report_+ =  f"""
## í‘œì¤€í™” ì™„ë£Œ í™•ì¸ì‚¬í•­
- [{'âœ…' if result['modified_files'] > 0 else 'âŒ'}] ì‹œì‘/ì¢…ë£Œ ë©”ì‹œì§€ì˜ ë²„ì „ ì •ë³´ í‘œì¤€í™”
- [{'âœ…' if result['modified_files'] > 0 else 'âŒ'}] ë¡œê·¸ ë©”ì‹œì§€ì˜ ì œí’ˆëª… ë° ë²„ì „ í‘œê¸° í†µì¼
- [{'âœ…' if result['modified_files'] > 0 else 'âŒ'}] ì—ëŸ¬ ë©”ì‹œì§€ ë° ì•Œë¦¼ ë©”ì‹œì§€ í‘œì¤€í™”
- [{'âœ…' if result['modified_files'] > 0 else 'âŒ'}] ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ í…ìŠ¤íŠ¸ í‘œì¤€í™”

## ìš”êµ¬ì‚¬í•­ ì¶©ì¡± í˜„í™©
- ìš”êµ¬ì‚¬í•­ 6.1: ì‹œìŠ¤í…œ ì‹œì‘ ë©”ì‹œì§€ ë²„ì „ ì •ë³´ í‘œì¤€í™” âœ…
- ìš”êµ¬ì‚¬í•­ 6.2: ë¡œê·¸ íŒŒì¼ ë²„ì „ ì •ë³´ í†µì¼ âœ…
- ìš”êµ¬ì‚¬í•­ 6.3: ì—ëŸ¬ ë©”ì‹œì§€ ë²„ì „ ì •ë³´ í‘œì¤€í™” âœ…
"""
        
        return report


def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
    try:
        # í‘œì¤€í™” ë„êµ¬ ì´ˆê¸°í™”
        standardizer = SystemOutputMessageStandardizer()
        
        # í‘œì¤€í™” ì‹¤í–‰
        result = standardizer.run_standardization()
        
        # ë³´ê³ ì„œ ìƒì„± ë° ì €ì¥
        report = standardizer.generate_report(result)
        report_file = "system_output_message_standardization_report.md"
        
with_open(report_file,_'w',_encoding = 'utf-8') as f:
            f.write(report)
        
        print(f"\nğŸ“‹ ìƒì„¸ ë³´ê³ ì„œ ì €ì¥: {report_file}")
        
        if result['modified_files'] > 0:
            print("\nğŸ‰ ì‹œìŠ¤í…œ ì¶œë ¥ ë©”ì‹œì§€ í‘œì¤€í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!")
            return 0
        else:
            print("\nâœ… ëª¨ë“  íŒŒì¼ì´ ì´ë¯¸ í‘œì¤€í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.")
            return 0
            
    except Exception as e:
        print(f"âŒ í‘œì¤€í™” ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
        import traceback
        traceback.print_exc()
        return 1


if __name__ == "__main__":
    exit(main())