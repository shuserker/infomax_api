#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Shell Batch Script Standardizer
POSCO ì‹œìŠ¤í…œ êµ¬ì„±ìš”ì†Œ

WatchHamster v3.0 ë° POSCO News 250808 í˜¸í™˜
Created: 2025-08-08
"""

import os
import re
import shutil
from pathlib import Path
from typing import Dict, List, Tuple, Optional
from dataclasses import dataclass
from datetime import datetime
import logging

# ê¸°ì¡´ ë„¤ì´ë° ì»¨ë²¤ì…˜ ë§¤ë‹ˆì € import
from naming_convention_manager import NamingConventionManager, ComponentType, ConversionResult


@dataclass
class ScriptStandardizationResult:
    """ìŠ¤í¬ë¦½íŠ¸ í‘œì¤€í™” ê²°ê³¼"""
    original_path: str
    new_path: str
    internal_changes: List[str]
    success: bool
    error_message: str = ""


class ShellBatchScriptStandardizer:
    """
    Shell/Batch ìŠ¤í¬ë¦½íŠ¸ í‘œì¤€í™” í´ë˜ìŠ¤
    
    íŒŒì¼ëª…, ë‚´ë¶€ ë³€ìˆ˜ëª…, í•¨ìˆ˜ëª…, ê²½ë¡œ ì°¸ì¡°ë¥¼ í‘œì¤€í™”í•©ë‹ˆë‹¤.
    """
    
    def __init__(self):
        """ì´ˆê¸°í™”"""
        self.naming_manager = NamingConventionManager()
self.results:_List[ScriptStandardizationResult] =  []
        self.backup_dir = Path(".naming_backup/scripts")
        self.backup_dir.mkdir(parents=True, exist_ok=True)
        
        # ë¡œê¹… ì„¤ì •
        logging.basicConfig(
            level=logging.INFO,
            format='%(asctime)s - %(levelname)s - %(message)s',
            handlers=[
                logging.FileHandler('script_standardization.log'),
                logging.StreamHandler()
            ]
        )
        self.logger = logging.getLogger(__name__)
    
    def find_all_scripts(self) -> List[Path]:
        """ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ ì°¾ê¸°"""
        script_extensions = ['.bat', '.sh', '.command', '.ps1']
        script_files = []
        
        for ext in script_extensions:
            script_files.extend(Path('.').rglob(f'*{ext}'))
        
        # ë°±ì—… ë””ë ‰í† ë¦¬ ì œì™¸
        script_files = [f for f in script_files if '.naming_backup' not in str(f)]
        
        self.logger.info(f"ë°œê²¬ëœ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼: {len(script_files)}ê°œ")
        return script_files
    
    def standardize_all_scripts(self) -> List[ScriptStandardizationResult]:
        """ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ í‘œì¤€í™”"""
        script_files = self.find_all_scripts()
        
        for script_file in script_files:
            try:
                result = self.standardize_script(script_file)
                self.results.append(result)
            except Exception as e:
                error_result = ScriptStandardizationResult(
                    original_path=str(script_file),
                    new_path=str(script_file),
                    internal_changes=[],
                    success=False,
                    error_message=str(e)
                )
                self.results.append(error_result)
                self.logger.error(f"ìŠ¤í¬ë¦½íŠ¸ í‘œì¤€í™” ì‹¤íŒ¨: {script_file} - {e}")
        
        return self.results
    
    def standardize_script(self, script_path: Path) -> ScriptStandardizationResult:
        """ê°œë³„ ìŠ¤í¬ë¦½íŠ¸ í‘œì¤€í™”"""
        self.logger.info(f"ìŠ¤í¬ë¦½íŠ¸ í‘œì¤€í™” ì‹œì‘: {script_path}")
        
        # ë°±ì—… ìƒì„±
        backup_path = self.backup_dir / script_path.name
        shutil.copy2(script_path, backup_path)
        
        # íŒŒì¼ëª… í‘œì¤€í™”
        new_filename = self._standardize_filename(script_path.name)
        new_path = script_path.parent / new_filename
        
        # íŒŒì¼ ë‚´ìš© ì½ê¸°
        try:
with_open(script_path,_'r',_encoding = 'utf-8') as f:
                content = f.read()
        except UnicodeDecodeError:
            # UTF-8ë¡œ ì½ê¸° ì‹¤íŒ¨ì‹œ ë‹¤ë¥¸ ì¸ì½”ë”© ì‹œë„
with_open(script_path,_'r',_encoding = 'cp949') as f:
                content = f.read()
        
        # ë‚´ë¶€ ë‚´ìš© í‘œì¤€í™”
standardized_content,_internal_changes =  self._standardize_content(content, script_path.suffix)
        
        # ìƒˆ íŒŒì¼ë¡œ ì €ì¥
with_open(new_path,_'w',_encoding = 'utf-8') as f:
            f.write(standardized_content)
        
        # ì‹¤í–‰ ê¶Œí•œ ë³µì‚¬ (Unix ê³„ì—´)
        if script_path.suffix in ['.sh', '.command'] and os.name == 'posix':
            shutil.copystat(script_path, new_path)
        
        # ì›ë³¸ íŒŒì¼ ì‚­ì œ (íŒŒì¼ëª…ì´ ë³€ê²½ëœ ê²½ìš°)
        if new_path != script_path:
            script_path.unlink()
        
        result = ScriptStandardizationResult(
            original_path=str(script_path),
            new_path=str(new_path),
            internal_changes=internal_changes,
            success=True
        )
        
        self.logger.info(f"ìŠ¤í¬ë¦½íŠ¸ í‘œì¤€í™” ì™„ë£Œ: {script_path} -> {new_path}")
        return result
    
    def _standardize_filename(self, filename: str) -> str:
        """íŒŒì¼ëª… í‘œì¤€í™”"""
        # ë„¤ì´ë° ì»¨ë²¤ì…˜ ë§¤ë‹ˆì € ì‚¬ìš©
        result = self.naming_manager.standardize_filename(filename)
        
        if result.success:
            return result.converted
        
        # ì¶”ê°€ ìŠ¤í¬ë¦½íŠ¸ íŠ¹í™” ë³€í™˜ ê·œì¹™
        standardized = filename
        
        # ì›Œì¹˜í–„ìŠ¤í„° ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸
        watchhamster_patterns = [
            (r'WatchHamster v3.0\.bat', 'ğŸ¹WatchHamster_v3.0_Control_Center.bat'),
            (r'WatchHamster v3.0.0_Integrated_Center.bat'),
            (r'POSCO_ì œì–´ì„¼í„°_ì‹¤í–‰_v2\.bat', 'ğŸ›ï¸WatchHamster_v3.0_Control_Panel.bat'),
            (r'POSCO_ì œì–´ì„¼í„°_Macì‹¤í–‰\.command', 'ğŸ›ï¸WatchHamster_v3.0_Control_Panel.command'),
            (r'POSCO_ì œì–´ì„¼í„°_ì‹¤í–‰_v2\.sh', 'ğŸ›ï¸WatchHamster_v3.0_Control_Panel.sh'),
            (r'watchhamster_control_center\.sh', 'watchhamster_v3.0_control_center.sh'),
            (r'watchhamster_master_control\.sh', 'watchhamster_v3.0_master_control.sh'),
            (r'watchhamster_master_control\.ps1', 'watchhamster_v3.0_master_control.ps1'),
            (r'watchhamster_control_center\.ps1', 'watchhamster_v3.0_control_center.ps1'),
        ]
        
        # POSCO News 250808 ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸
POSCO_News_250808_patterns =  [
            (r'posco_control_center\.sh', 'POSCO News 250808_250808_control_center.sh'),
            (r'posco_control_mac\.sh', 'POSCO News 250808_250808_control_mac.sh'),
            (r'POSCO_ë©”ì¸_ì•Œë¦¼_ì‹œì‘\.bat', 'ğŸš€POSCO_News_250808_Start.bat'),
            (r'POSCO_ë©”ì¸_ì•Œë¦¼_ì¤‘ì§€\.bat', 'ğŸ›‘POSCO_News_250808_Stop.bat'),
            (r'POSCO_ë©”ì¸_ì•Œë¦¼_ì‹œì‘_ì§ì ‘\.bat', 'ğŸš€POSCO_News_250808_Direct_Start.bat'),
            (r'POSCO_ë©”ì¸_ì•Œë¦¼_ì‹œì‘_ì§ì ‘\.sh', 'ğŸš€POSCO_News_250808_Direct_Start.sh'),
        ]
        
        # íŒ¨í„´ ì ìš©
        for pattern, replacement in watchhamster_patterns + POSCO News 250808_patterns:
            standardized = re.sub(pattern, replacement, standardized, flags=re.IGNORECASE)
        
        return standardized
    
    def _standardize_content(self, content: str, file_extension: str) -> Tuple[str, List[str]]:
        """ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš© í‘œì¤€í™”"""
        changes = []
        standardized_content = content
        
        if file_extension == '.bat':
standardized_content,_bat_changes =  self._standardize_batch_content(standardized_content)
            changes.extend(bat_changes)
        elif file_extension in ['.sh', '.command']:
standardized_content,_sh_changes =  self._standardize_shell_content(standardized_content)
            changes.extend(sh_changes)
        elif file_extension == '.ps1':
standardized_content,_ps_changes =  self._standardize_powershell_content(standardized_content)
            changes.extend(ps_changes)
        
        return standardized_content, changes
    
    def _standardize_batch_content(self, content: str) -> Tuple[str, List[str]]:
        """Batch ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš© í‘œì¤€í™”"""
        changes = []
        
        # ì œëª© ë° í—¤ë” í‘œì¤€í™”
        title_patterns = [
            (r'title.*WatchHamster v3.0.*', 'title ğŸ¹ POSCO WatchHamster v3.0 í†µí•© ì œì–´ì„¼í„°'),
            (r'title.*WatchHamster v3.0.*', 'title ğŸ¹ POSCO WatchHamster v3.0 í†µí•© ì œì–´ì„¼í„°'),
            (r'title.*POSCO.*ì œì–´ì„¼í„°.*', 'title ğŸ›ï¸ POSCO WatchHamster v3.0 Control Panel'),
        ]
        
        for pattern, replacement in title_patterns:
            if re.search(pattern, content, re.IGNORECASE):
                content = re.sub(pattern, replacement, content, flags=re.IGNORECASE)
                changes.append(f"ì œëª© í‘œì¤€í™”: {replacement}")
        
        # ë³€ìˆ˜ëª… í‘œì¤€í™”
        variable_patterns = [
            (r'WATCHHAMSTER_VERSION\s*=\s*"v2\.0?"', 'WATCHHAMSTER_VERSION="v3.0"'),
            (r'POSCO_NEWS_VERSION\s*=\s*"mini_v2"', 'POSCO_NEWS_VERSION="250808"'),
            (r'set\s+watchhamster_v2', 'set watchhamster_v3_0'),
            (r'set\s+POSCO News 250808_mini', 'set POSCO News 250808_250808'),
        ]
        
        for pattern, replacement in variable_patterns:
            if re.search(pattern, content, re.IGNORECASE):
                content = re.sub(pattern, replacement, content, flags=re.IGNORECASE)
                changes.append(f"ë³€ìˆ˜ëª… í‘œì¤€í™”: {replacement}")
        
        # íŒŒì¼ ê²½ë¡œ ì°¸ì¡° ì—…ë°ì´íŠ¸
        path_patterns = [
            (r'Monitoring\\POSCO News 250808_mini_v2', 'Monitoring\\WatchHamster_v3.0'),
            (r'monitor_WatchHamster\.py', 'monitor_WatchHamster_v3.0.py'),
            (r'demo_v2_integration\.py', 'demo_watchhamster_v3.0_integration.py'),
            (r'test_v2_integration\.py', 'test_watchhamster_v3.0_integration.py'),
        ]
        
        for pattern, replacement in path_patterns:
            if re.search(pattern, content):
                content = re.sub(pattern, replacement, content)
                changes.append(f"ê²½ë¡œ ì°¸ì¡° ì—…ë°ì´íŠ¸: {replacement}")
        
        # ì£¼ì„ ë° ë©”ì‹œì§€ í‘œì¤€í™”
        comment_patterns = [
            (r'WatchHamster v3.0\.0?', 'WatchHamster v3.0.0'),
            (r'WatchHamster\s*v2\.0?', 'WatchHamster v3.0'),
            (r'POSCO\s*News\s*mini', 'POSCO News 250808'),
            (r'v2\.0?\s*í˜ì‹ ', 'v3.0 í˜ì‹ '),
        ]
        
        for pattern, replacement in comment_patterns:
            if re.search(pattern, content, re.IGNORECASE):
                content = re.sub(pattern, replacement, content, flags=re.IGNORECASE)
                changes.append(f"ì£¼ì„ í‘œì¤€í™”: {replacement}")
        
        return content, changes
    
    def _standardize_shell_content(self, content: str) -> Tuple[str, List[str]]:
        """Shell ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš© í‘œì¤€í™”"""
        changes = []
        
        # í—¤ë” ì£¼ì„ í‘œì¤€í™”
        header_patterns = [
            (r'#.*POSCO.*WatchHamster.*Control.*Center.*v2\.0?', '# POSCO WatchHamster v3.0 Control Center'),
            (r'#.*WatchHamster v3.0', '# POSCO WatchHamster v3.0.0 í†µí•© ì œì–´ì„¼í„°'),
            (r'#.*POSCO.*ì œì–´.*ì„¼í„°.*ì‹¤í–‰ê¸°.*v2', '# POSCO WatchHamster v3.0 Control Panel'),
        ]
        
        for pattern, replacement in header_patterns:
            if re.search(pattern, content, re.IGNORECASE):
                content = re.sub(pattern, replacement, content, flags=re.IGNORECASE)
                changes.append(f"í—¤ë” í‘œì¤€í™”: {replacement}")
        
        # ë³€ìˆ˜ëª… í‘œì¤€í™”
        variable_patterns = [
            (r'WATCHHAMSTER_VERSION="v2\.0?"', 'WATCHHAMSTER_VERSION="v3.0"'),
            (r'POSCO_NEWS_VERSION="mini_v2"', 'POSCO_NEWS_VERSION="250808"'),
            (r'watchhamster_v2_', 'watchhamster_v3_0_'),
            (r'POSCO News 250808_mini_', 'POSCO News 250808_250808_'),
        ]
        
        for pattern, replacement in variable_patterns:
            if re.search(pattern, content):
                content = re.sub(pattern, replacement, content)
                changes.append(f"ë³€ìˆ˜ëª… í‘œì¤€í™”: {replacement}")
        
        # í•¨ìˆ˜ëª… í‘œì¤€í™”
        function_patterns = [
            (r'start_watchhamster_v2\(\)', 'start_watchhamster_v3_0()'),
            (r'check_watchhamster_v2_status\(\)', 'check_watchhamster_v3_0_status()'),
            (r'POSCO News 250808_mini_monitor\(\)', 'POSCO News 250808_250808_monitor()'),
        ]
        
        for pattern, replacement in function_patterns:
            if re.search(pattern, content):
                content = re.sub(pattern, replacement, content)
                changes.append(f"í•¨ìˆ˜ëª… í‘œì¤€í™”: {replacement}")
        
        # íŒŒì¼ ê²½ë¡œ ì°¸ì¡° ì—…ë°ì´íŠ¸
        path_patterns = [
            (r'Monitoring/POSCO News 250808_mini_v2', 'Monitoring/WatchHamster_v3.0'),
            (r'monitor_WatchHamster\.py', 'monitor_WatchHamster_v3.0.py'),
            (r'demo_v2_integration\.py', 'demo_watchhamster_v3.0_integration.py'),
            (r'test_v2_integration\.py', 'test_watchhamster_v3.0_integration.py'),
            (r'posco_control_center\.sh', 'POSCO News 250808_250808_control_center.sh'),
        ]
        
        for pattern, replacement in path_patterns:
            if re.search(pattern, content):
                content = re.sub(pattern, replacement, content)
                changes.append(f"ê²½ë¡œ ì°¸ì¡° ì—…ë°ì´íŠ¸: {replacement}")
        
        # ì¶œë ¥ ë©”ì‹œì§€ í‘œì¤€í™”
        message_patterns = [
            (r'WatchHamster v3.0\.0?', 'WatchHamster v3.0.0'),
            (r'WatchHamster\s*v2\.0?', 'WatchHamster v3.0'),
            (r'POSCO\s*News\s*mini', 'POSCO News 250808'),
            (r'v2\.0?\s*í˜ì‹ ', 'v3.0 í˜ì‹ '),
        ]
        
        for pattern, replacement in message_patterns:
            if re.search(pattern, content, re.IGNORECASE):
                content = re.sub(pattern, replacement, content, flags=re.IGNORECASE)
                changes.append(f"ë©”ì‹œì§€ í‘œì¤€í™”: {replacement}")
        
        return content, changes
    
    def _standardize_powershell_content(self, content: str) -> Tuple[str, List[str]]:
        """PowerShell ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš© í‘œì¤€í™”"""
        changes = []
        
        # í—¤ë” ì£¼ì„ í‘œì¤€í™”
        header_patterns = [
            (r'#.*POSCO.*WatchHamster.*v2\.0?', '# POSCO WatchHamster v3.0 Control System'),
            (r'#.*WatchHamster v3.0', '# POSCO WatchHamster v3.0.0 ì œì–´ ì‹œìŠ¤í…œ'),
        ]
        
        for pattern, replacement in header_patterns:
            if re.search(pattern, content, re.IGNORECASE):
                content = re.sub(pattern, replacement, content, flags=re.IGNORECASE)
                changes.append(f"í—¤ë” í‘œì¤€í™”: {replacement}")
        
        # ë³€ìˆ˜ëª… í‘œì¤€í™”
        variable_patterns = [
            (r'\$WatchHamsterVersion\s*=\s*"v2\.0?"', '$WatchHamsterVersion = "v3.0"'),
            (r'\$PoscoNewsVersion\s*=\s*"mini_v2"', '$PoscoNewsVersion = "250808"'),
            (r'\$watchhamster_v2', '$watchhamster_v3_0'),
            (r'\$POSCO News 250808_mini', '$POSCO News 250808_250808'),
        ]
        
        for pattern, replacement in variable_patterns:
            if re.search(pattern, content):
                content = re.sub(pattern, replacement, content)
                changes.append(f"ë³€ìˆ˜ëª… í‘œì¤€í™”: {replacement}")
        
        # í•¨ìˆ˜ëª… í‘œì¤€í™”
        function_patterns = [
            (r'function\s+Start-WatchHamster v3.0', 'function Start-WatchHamster v3.00'),
            (r'function\s+Stop-WatchHamster v3.0', 'function Stop-WatchHamster v3.00'),
            (r'function\s+Get-POSCO News 250808', 'function Get-POSCO News 250808'),
        ]
        
        for pattern, replacement in function_patterns:
            if re.search(pattern, content):
                content = re.sub(pattern, replacement, content)
                changes.append(f"í•¨ìˆ˜ëª… í‘œì¤€í™”: {replacement}")
        
        return content, changes
    
    def generate_standardization_report(self) -> str:
        """í‘œì¤€í™” ë³´ê³ ì„œ ìƒì„±"""
        successful = [r for r in self.results if r.success]
        failed = [r for r in self.results if not r.success]
        
        report = f"""
POSCO Shell/Batch ìŠ¤í¬ë¦½íŠ¸ ë„¤ì´ë° í‘œì¤€í™” ë³´ê³ ì„œ
==============================================

ì‹¤í–‰ ì‹œê°„: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

ğŸ“Š ì „ì²´ í†µê³„:
- ì´ ì²˜ë¦¬ëœ ìŠ¤í¬ë¦½íŠ¸: {len(self.results)}ê°œ
- ì„±ê³µì ìœ¼ë¡œ í‘œì¤€í™”ëœ ìŠ¤í¬ë¦½íŠ¸: {len(successful)}ê°œ
- ì‹¤íŒ¨í•œ ìŠ¤í¬ë¦½íŠ¸: {len(failed)}ê°œ

âœ… ì„±ê³µí•œ í‘œì¤€í™”:
"""
        
        for result in successful:
report_+ =  f"\nğŸ“ {result.original_path}"
            if result.new_path != result.original_path:
report_+ =  f" â†’ {result.new_path}"
            
            if result.internal_changes:
report_+ =  f"\n   ë‚´ë¶€ ë³€ê²½ì‚¬í•­:"
                for change in result.internal_changes:
report_+ =  f"\n   â€¢ {change}"
report_+ =  "\n"
        
        if failed:
report_+ =  f"\nâŒ ì‹¤íŒ¨í•œ í‘œì¤€í™”:\n"
            for result in failed:
report_+ =  f"\nğŸ“ {result.original_path}"
                report += f"\n   ì˜¤ë¥˜: {result.error_message}\n"
        
report_+ =  f"""
ğŸ”§ í‘œì¤€í™” ê·œì¹™ ì ìš©:
- WatchHamster ê´€ë ¨: v3.0 ë²„ì „ ì²´ê³„ ì ìš©
- POSCO News ê´€ë ¨: 250808 ë‚ ì§œ ì²´ê³„ ì ìš©
- íŒŒì¼ëª…: ì´ëª¨ì§€ ë° í‘œì¤€ í˜•ì‹ ì ìš©
- ë‚´ë¶€ ë³€ìˆ˜ëª…: ì¼ê´€ëœ ë„¤ì´ë° ê·œì¹™ ì ìš©
- í•¨ìˆ˜ëª…: ë²„ì „ ì •ë³´ í¬í•¨ í‘œì¤€í™”
- ê²½ë¡œ ì°¸ì¡°: ìƒˆë¡œìš´ êµ¬ì¡°ì— ë§ê²Œ ì—…ë°ì´íŠ¸
- ì£¼ì„ ë° ë©”ì‹œì§€: í†µì¼ëœ ë²„ì „ í‘œê¸°

ğŸ’¾ ë°±ì—… ìœ„ì¹˜: {self.backup_dir}
"""
        
        return report
    
    def rollback_changes(self) -> bool:
        """ë³€ê²½ì‚¬í•­ ë¡¤ë°±"""
        try:
            for result in self.results:
                if result.success:
                    backup_file = self.backup_dir / Path(result.original_path).name
                    if backup_file.exists():
                        # ìƒˆ íŒŒì¼ ì‚­ì œ
                        if Path(result.new_path).exists():
                            Path(result.new_path).unlink()
                        
                        # ë°±ì—…ì—ì„œ ë³µì›
                        shutil.copy2(backup_file, result.original_path)
                        self.logger.info(f"ë¡¤ë°± ì™„ë£Œ: {result.original_path}")
            
            return True
        except Exception as e:
            self.logger.error(f"ë¡¤ë°± ì‹¤íŒ¨: {e}")
            return False


def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
    print("POSCO Shell/Batch ìŠ¤í¬ë¦½íŠ¸ ë„¤ì´ë° í‘œì¤€í™” ì‹œìŠ¤í…œ")
    print("=" * 50)
    
    standardizer = ShellBatchScriptStandardizer()
    
    # ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ í‘œì¤€í™”
    print("ğŸ” ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ ê²€ìƒ‰ ë° í‘œì¤€í™” ì¤‘...")
    results = standardizer.standardize_all_scripts()
    
    # ë³´ê³ ì„œ ìƒì„±
    report = standardizer.generate_standardization_report()
    
    # ë³´ê³ ì„œ íŒŒì¼ë¡œ ì €ì¥
with_open('script_standardization_report.md',_'w',_encoding = 'utf-8') as f:
        f.write(report)
    
    print(report)
    print(f"\nğŸ“„ ìƒì„¸ ë³´ê³ ì„œê°€ 'script_standardization_report.md'ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
    
    # ì‚¬ìš©ì í™•ì¸
    while True:
        choice = input("\në³€ê²½ì‚¬í•­ì„ ìœ ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n/r=rollback): ").lower()
        if choice == 'y':
            print("âœ… ë³€ê²½ì‚¬í•­ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.")
            break
        elif choice == 'n' or choice == 'r':
            print("ğŸ”„ ë³€ê²½ì‚¬í•­ì„ ë¡¤ë°±í•©ë‹ˆë‹¤...")
            if standardizer.rollback_changes():
                print("âœ… ë¡¤ë°±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
            else:
                print("âŒ ë¡¤ë°±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë°±ì—… íŒŒì¼ì„ ìˆ˜ë™ìœ¼ë¡œ ë³µì›í•´ì£¼ì„¸ìš”.")
            break
        else:
            print("ì˜¬ë°”ë¥¸ ì„ íƒì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (y/n/r)")


if __name__ == "__main__":
    main()