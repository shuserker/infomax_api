#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Posco Continuous Monitor
POSCO ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

WatchHamster v3.0 ë° POSCO News 250808 í˜¸í™˜
Created: 2025-08-08
"""

import posco_news_250808_monitor.log
import system_functionality_verification.py
import .comprehensive_repair_backup/realtime_news_monitor.py.backup_20250809_181657
# BROKEN_REF: import subprocess
# BROKEN_REF: from datetime import datetime
# BROKEN_REF: import signal

class POSCO News 250808ContinuousMonitor:
    def __init__(self):
        self.running = True
        self.interval = 30 * 60  # 30ë¶„ (ì´ˆ ë‹¨ìœ„)
        self.script_path = "Monitoring/POSCO_News_250808/reports/integrated_report_generator.py"
        
        # ì‹ í˜¸ í•¸ë“¤ëŸ¬ ë“±ë¡ (Ctrl+Cë¡œ ì¢…ë£Œ)
        signal.signal(signal.SIGINT, self.signal_handler)
        signal.signal(signal.SIGTERM, self.signal_handler)
    
    def signal_handler(self, signum, frame):
        """ì¢…ë£Œ ì‹ í˜¸ ì²˜ë¦¬"""
        print(f"\nğŸ›‘ ì¢…ë£Œ ì‹ í˜¸ ìˆ˜ì‹  (ì‹ í˜¸: {signum})")
        print("ğŸ“‹ POSCO ì§€ì†ì  ëª¨ë‹ˆí„°ë§ì„ ì¢…ë£Œí•©ë‹ˆë‹¤...")
        self.running = False
    
    def log_message(self, message):
        """ë¡œê·¸ ë©”ì‹œì§€ ì¶œë ¥"""
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        print(f"[{timestamp}] {message}")
    
    def run_report_generator(self):
        """ë¦¬í¬íŠ¸ ìƒì„±ê¸° ì‹¤í–‰"""
        try:
            self.log_message("ğŸš€ POSCO ë¦¬í¬íŠ¸ ìƒì„±ê¸° ì‹¤í–‰ ì¤‘...")
            
            # ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
            result = subprocess.run([
                sys.executable, self.script_path
],_capture_output = True, text=True, cwd=".")
            
            if result.returncode == 0:
                self.log_message("âœ… ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ")
                if result.stdout:
                    # ë§ˆì§€ë§‰ ëª‡ ì¤„ë§Œ ì¶œë ¥
                    lines = result.stdout.strip().split('\n')
                    for line in lines[-3:]:
                        if line.strip():
                            self.log_message(f"   {line}")
            else:
                self.log_message("âŒ ë¦¬í¬íŠ¸ ìƒì„± ì‹¤íŒ¨")
                if result.stderr:
                    self.log_message(f"   ì˜¤ë¥˜: {result.stderr[:200]}...")
                    
        except Exception as e:
            self.log_message(f"âŒ ì‹¤í–‰ ì˜¤ë¥˜: {str(e)}")
    
    def run(self):
        """ë©”ì¸ ëª¨ë‹ˆí„°ë§ ë£¨í”„"""
        self.log_message("ğŸ­ POSCO ì§€ì†ì  ëª¨ë‹ˆí„°ë§ ì‹œì‘")
        self.log_message(f"â° ì‹¤í–‰ ì£¼ê¸°: {self.interval // 60}ë¶„")
        self.log_message("ğŸ›‘ ì¢…ë£Œí•˜ë ¤ë©´ Ctrl+Cë¥¼ ëˆ„ë¥´ì„¸ìš”")
        print("=" * 60)
        
        # ì²« ë²ˆì§¸ ì‹¤í–‰
        self.run_report_generator()
        
        # ì£¼ê¸°ì  ì‹¤í–‰
        while self.running:
            try:
                self.log_message(f"â³ {self.interval // 60}ë¶„ ëŒ€ê¸° ì¤‘... (Ctrl+Cë¡œ ì¢…ë£Œ)")
                
                # ì¸í„°ëŸ½íŠ¸ ê°€ëŠ¥í•œ ëŒ€ê¸°
                for i in range(self.interval):
                    if not self.running:
                        break
                    time.sleep(1)
                
                if self.running:
                    self.run_report_generator()
                    
            except KeyboardInterrupt:
                self.signal_handler(signal.SIGINT, None)
                break
        
        self.log_message("ğŸ“‹ POSCO ì§€ì†ì  ëª¨ë‹ˆí„°ë§ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")

def main():
    """ë©”ì¸ í•¨ìˆ˜"""
    print("ğŸ­ POSCO ì§€ì†ì  ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ")
    print("=" * 60)
    
    # í•„ìˆ˜ íŒŒì¼ í™•ì¸
    script_path = "Monitoring/POSCO_News_250808/reports/integrated_report_generator.py"
    if not os.path.exists(script_path):
        print(f"âŒ ì˜¤ë¥˜: {script_path} íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        print("ğŸ“ í˜„ì¬ ê²½ë¡œì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.")
        return 1
    
    # ëª¨ë‹ˆí„° ì‹œì‘
    monitor = PoscoContinuousMonitor()
    monitor.run()
    
    return 0

if __name__ == "__main__":
    sys.exit(main())