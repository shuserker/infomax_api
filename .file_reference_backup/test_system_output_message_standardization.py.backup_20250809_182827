#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Test System Output Message Standardization
ì‹œìŠ¤í…œ ì¶œë ¥ ë©”ì‹œì§€ í‘œì¤€í™” í…ŒìŠ¤íŠ¸

WatchHamster v3.0 ë° POSCO News 250808 í˜¸í™˜
Created: 2025-08-08
"""

# BROKEN_REF: import unittest
# BROKEN_REF: import tempfile
import posco_news_250808_monitor.log
# BROKEN_REF: from pathlib import Path
# BROKEN_REF: from system_output_message_standardizer.py import SystemOutputMessageStandardizer


class TestSystemOutputMessageStandardization(unittest.TestCase):
    """ì‹œìŠ¤í…œ ì¶œë ¥ ë©”ì‹œì§€ í‘œì¤€í™” í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤"""
    
    def setUp(self):
        """í…ŒìŠ¤íŠ¸ ì„¤ì •"""
        self.temp_dir = tempfile.mkdtemp()
        self.standardizer = SystemOutputMessageStandardizer(self.temp_dir)
    
    def tearDown(self):
        """í…ŒìŠ¤íŠ¸ ì •ë¦¬"""
# BROKEN_REF:         import shutil
        shutil.rmtree(self.temp_dir)
    
    def create_test_file(self, filename: str, content: str) -> Path:
        """í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±"""
        file_path = Path(self.temp_dir) / filename
with_open(file_path,_'w',_encoding = 'utf-8') as f:
            f.write(content)
        return file_path
    
    def test_watchhamster_version_standardization(self):
        """ì›Œì¹˜í–„ìŠ¤í„° ë²„ì „ í‘œì¤€í™” í…ŒìŠ¤íŠ¸"""
        # í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±
        content = '''
print("ì›Œì¹˜í–„ìŠ¤í„° v2 ì‹œì‘")
print("POSCO ì›Œì¹˜í–„ìŠ¤í„° v3 ì´ˆê¸°í™”")
print("ì›Œì¹˜í–„ìŠ¤í„° v2.0 ìƒíƒœ ì²´í¬")
'''
        file_path = self.create_test_file("Monitoring/POSCO_News_250808/backup_archive_20250806/test_files/Monitoring/POSCO_News_250808/backup_archive_20250806/test_files/test_watchhamster.py", content)
        
        # í‘œì¤€í™” ì‹¤í–‰
        result = self.standardizer.standardize_output_messages(file_path)
        
        # ê²°ê³¼ í™•ì¸
        self.assertTrue(result)
        
        # íŒŒì¼ ë‚´ìš© í™•ì¸
with_open(file_path,_'r',_encoding = 'utf-8') as f:
            standardized_content = f.read()
        
        self.assertIn("WatchHamster v3.0 ì‹œì‘", standardized_content)
        self.assertIn("POSCO WatchHamster v3.0 ì´ˆê¸°í™”", standardized_content)
        self.assertNotIn("v2", standardized_content)
    
    def test_posco_news_version_standardization(self):
        """í¬ìŠ¤ì½” ë‰´ìŠ¤ ë²„ì „ í‘œì¤€í™” í…ŒìŠ¤íŠ¸"""
        # í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±
        content = '''
print("í¬ìŠ¤ì½” ë‰´ìŠ¤ ì‹œì‘")
print("Posco News mini ì•Œë¦¼")
print("posco news ìƒíƒœ ì²´í¬")
'''
# BROKEN_REF:         file_path = self.create_test_file("test_POSCO News 250808.py", content)
        
        # í‘œì¤€í™” ì‹¤í–‰
        result = self.standardizer.standardize_output_messages(file_path)
        
        # ê²°ê³¼ í™•ì¸
        self.assertTrue(result)
        
        # íŒŒì¼ ë‚´ìš© í™•ì¸
with_open(file_path,_'r',_encoding = 'utf-8') as f:
            standardized_content = f.read()
        
        self.assertIn("POSCO News 250808", standardized_content)
        self.assertNotIn("í¬ìŠ¤ì½” ë‰´ìŠ¤", standardized_content)
        self.assertNotIn("Posco News mini", standardized_content)
    
    def test_log_message_standardization(self):
        """ë¡œê·¸ ë©”ì‹œì§€ í‘œì¤€í™” í…ŒìŠ¤íŠ¸"""
        # í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±
        content = '''
def log_message(msg):
    print(f"[LOG] ì›Œì¹˜í–„ìŠ¤í„° v2: {msg}")
    print(f"[INFO] í¬ìŠ¤ì½” ë‰´ìŠ¤ ìƒíƒœ: {msg}")
    print(f"[ERROR] POSCO ì›Œì¹˜í–„ìŠ¤í„° ì˜¤ë¥˜: {msg}")
'''
# BROKEN_REF:         file_path = self.create_test_file("test_log.py", content)
        
        # í‘œì¤€í™” ì‹¤í–‰
        result = self.standardizer.standardize_output_messages(file_path)
        
        # ê²°ê³¼ í™•ì¸
        self.assertTrue(result)
        
        # íŒŒì¼ ë‚´ìš© í™•ì¸
with_open(file_path,_'r',_encoding = 'utf-8') as f:
            standardized_content = f.read()
        
        self.assertIn("WatchHamster v3.0", standardized_content)
        self.assertIn("POSCO News 250808", standardized_content)
        self.assertIn("POSCO WatchHamster v3.0", standardized_content)
    
    def test_error_message_standardization(self):
        """ì—ëŸ¬ ë©”ì‹œì§€ í‘œì¤€í™” í…ŒìŠ¤íŠ¸"""
        # í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±
        content = '''
try:
    pass
except Exception as e:
    print("ì›Œì¹˜í–„ìŠ¤í„° v2 ì˜¤ë¥˜ ë°œìƒ")
    print("í¬ìŠ¤ì½” ë‰´ìŠ¤ ì‹¤íŒ¨")
    print("ì›Œì¹˜í–„ìŠ¤í„° ì—°ê²° ì‹¤íŒ¨")
'''
# BROKEN_REF:         file_path = self.create_test_file("test_error.py", content)
        
        # í‘œì¤€í™” ì‹¤í–‰
        result = self.standardizer.standardize_output_messages(file_path)
        
        # ê²°ê³¼ í™•ì¸
        self.assertTrue(result)
        
        # íŒŒì¼ ë‚´ìš© í™•ì¸
with_open(file_path,_'r',_encoding = 'utf-8') as f:
            standardized_content = f.read()
        
        self.assertIn("WatchHamster v3.0 ì˜¤ë¥˜", standardized_content)
        self.assertIn("POSCO News 250808 ì‹¤íŒ¨", standardized_content)
        self.assertIn("WatchHamster v3.0 ì‹¤íŒ¨", standardized_content)
    
    def test_notification_message_standardization(self):
        """ì•Œë¦¼ ë©”ì‹œì§€ í‘œì¤€í™” í…ŒìŠ¤íŠ¸"""
        # í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±
        content = '''
def send_notification():
    payload = {
        "botName": "POSCO ë‰´ìŠ¤ ì•Œë¦¼",
        "text": "ì›Œì¹˜í–„ìŠ¤í„° v2 ì•Œë¦¼"
    }
    print("í¬ìŠ¤ì½” ì›Œì¹˜í–„ìŠ¤í„° ì•Œë¦¼ ì „ì†¡")
'''
# BROKEN_REF:         file_path = self.create_test_file("test_notification.py", content)
        
        # í‘œì¤€í™” ì‹¤í–‰
        result = self.standardizer.standardize_output_messages(file_path)
        
        # ê²°ê³¼ í™•ì¸
        self.assertTrue(result)
        
        # íŒŒì¼ ë‚´ìš© í™•ì¸
with_open(file_path,_'r',_encoding = 'utf-8') as f:
            standardized_content = f.read()
        
        self.assertIn("POSCO News 250808 ì•Œë¦¼", standardized_content)
        self.assertIn("WatchHamster v3.0 ì•Œë¦¼", standardized_content)
        self.assertIn("POSCO WatchHamster v3.0 ì•Œë¦¼", standardized_content)
    
    def test_shell_script_standardization(self):
        """Shell ìŠ¤í¬ë¦½íŠ¸ í‘œì¤€í™” í…ŒìŠ¤íŠ¸"""
        # í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±
        content = '''#!/bin/bash
echo "ì›Œì¹˜í–„ìŠ¤í„° v2 ì‹œì‘"
echo "í¬ìŠ¤ì½” ë‰´ìŠ¤ ëª¨ë‹ˆí„°ë§ ì‹œì‘"
echo "POSCO ì›Œì¹˜í–„ìŠ¤í„° ìƒíƒœ í™•ì¸"
'''
# BROKEN_REF:         file_path = self.create_test_file("test_script.sh", content)
        
        # í‘œì¤€í™” ì‹¤í–‰
        result = self.standardizer.standardize_output_messages(file_path)
        
        # ê²°ê³¼ í™•ì¸
        self.assertTrue(result)
        
        # íŒŒì¼ ë‚´ìš© í™•ì¸
with_open(file_path,_'r',_encoding = 'utf-8') as f:
            standardized_content = f.read()
        
        self.assertIn("WatchHamster v3.0 ì‹œì‘", standardized_content)
        self.assertIn("POSCO News 250808", standardized_content)
        self.assertIn("POSCO WatchHamster v3.0", standardized_content)
    
    def test_comment_standardization(self):
        """ì£¼ì„ í‘œì¤€í™” í…ŒìŠ¤íŠ¸"""
        # í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±
        content = '''
# ì›Œì¹˜í–„ìŠ¤í„° v2 ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ
# í¬ìŠ¤ì½” ë‰´ìŠ¤ ì•Œë¦¼ ê¸°ëŠ¥
# POSCO ì›Œì¹˜í–„ìŠ¤í„° v3 í†µí•©
def main():
    pass
'''
# BROKEN_REF:         file_path = self.create_test_file("test_comment.py", content)
        
        # í‘œì¤€í™” ì‹¤í–‰
        result = self.standardizer.standardize_output_messages(file_path)
        
        # ê²°ê³¼ í™•ì¸
        self.assertTrue(result)
        
        # íŒŒì¼ ë‚´ìš© í™•ì¸
with_open(file_path,_'r',_encoding = 'utf-8') as f:
            standardized_content = f.read()
        
        self.assertIn("WatchHamster v3.0", standardized_content)
        self.assertIn("POSCO News 250808", standardized_content)
        self.assertNotIn("v2", standardized_content)
    
    def test_no_changes_needed(self):
        """ë³€ê²½ì´ í•„ìš”ì—†ëŠ” íŒŒì¼ í…ŒìŠ¤íŠ¸"""
        # ì´ë¯¸ í‘œì¤€í™”ëœ íŒŒì¼ ìƒì„±
        content = '''
print("WatchHamster v3.0 ì‹œì‘")
print("POSCO News 250808 ì•Œë¦¼")
print("POSCO WatchHamster v3.0 ìƒíƒœ")
'''
# BROKEN_REF:         file_path = self.create_test_file("test_no_change.py", content)
        
        # í‘œì¤€í™” ì‹¤í–‰
        result = self.standardizer.standardize_output_messages(file_path)
        
        # ê²°ê³¼ í™•ì¸ - ë³€ê²½ì‚¬í•­ì´ ì—†ì–´ì•¼ í•¨
        self.assertFalse(result)
    
    def test_full_standardization_run(self):
        """ì „ì²´ í‘œì¤€í™” ì‹¤í–‰ í…ŒìŠ¤íŠ¸"""
        # ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±
        files_content = {
# BROKEN_REF:             "test1.py": 'print("ì›Œì¹˜í–„ìŠ¤í„° v2 ì‹œì‘")',
# BROKEN_REF:             "test2.py": 'print("í¬ìŠ¤ì½” ë‰´ìŠ¤ ì•Œë¦¼")',
# BROKEN_REF:             "test3.sh": 'echo "POSCO ì›Œì¹˜í–„ìŠ¤í„° ìƒíƒœ"',
# BROKEN_REF:             "test4.bat": 'echo "ì›Œì¹˜í–„ìŠ¤í„° ëª¨ë‹ˆí„°ë§"'
        }
        
        for filename, content in files_content.items():
            self.create_test_file(filename, content)
        
        # ì „ì²´ í‘œì¤€í™” ì‹¤í–‰
        result = self.standardizer.run_standardization()
        
        # ê²°ê³¼ í™•ì¸
        self.assertGreater(result['total_files'], 0)
        self.assertGreater(result['processed_files'], 0)
        self.assertGreater(result['modified_files'], 0)
        self.assertGreater(result['total_changes'], 0)
    
    def test_report_generation(self):
        """ë³´ê³ ì„œ ìƒì„± í…ŒìŠ¤íŠ¸"""
        # í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„± ë° í‘œì¤€í™”
        content = 'print("WatchHamster v3.0 í…ŒìŠ¤íŠ¸")'
        self.create_test_file("deploy_ladeploy_latest_report.py", content)
        
        result = self.standardizer.run_standardization()
        
        # ë³´ê³ ì„œ ìƒì„±
        report = self.standardizer.generate_report(result)
        
        # ë³´ê³ ì„œ ë‚´ìš© í™•ì¸
        self.assertIn("ì‹œìŠ¤í…œ ì¶œë ¥ ë©”ì‹œì§€ í‘œì¤€í™” ë³´ê³ ì„œ", report)
        self.assertIn("ì‹¤í–‰ ì‹œê°„", report)
        self.assertIn("ì²˜ë¦¬ ê²°ê³¼", report)
        self.assertIn("í‘œì¤€í™” ê·œì¹™", report)
        self.assertIn("ìš”êµ¬ì‚¬í•­ ì¶©ì¡± í˜„í™©", report)


def run_tests():
    """í…ŒìŠ¤íŠ¸ ì‹¤í–‰"""
    print("ğŸ§ª ì‹œìŠ¤í…œ ì¶œë ¥ ë©”ì‹œì§€ í‘œì¤€í™” í…ŒìŠ¤íŠ¸ ì‹œì‘")
    print("=" * 60)
    
    # í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸ ìƒì„±
    test_suite = unittest.TestLoader().loadTestsFromTestCase(TestSystemOutputMessageStandardization)
    
    # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    runner = unittest.TextTestRunner(verbosity=2)
    result = runner.run(test_suite)
    
    # ê²°ê³¼ ì¶œë ¥
print("\n"_+_" = " * 60)
    print("ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼")
    print("=" * 60)
    print(f"ì‹¤í–‰ëœ í…ŒìŠ¤íŠ¸: {result.testsRun}ê°œ")
    print(f"ì„±ê³µí•œ í…ŒìŠ¤íŠ¸: {result.testsRun - len(result.failures) - len(result.errors)}ê°œ")
    print(f"ì‹¤íŒ¨í•œ í…ŒìŠ¤íŠ¸: {len(result.failures)}ê°œ")
    print(f"ì˜¤ë¥˜ ë°œìƒ í…ŒìŠ¤íŠ¸: {len(result.errors)}ê°œ")
    
    if result.failures:
        print("\nâŒ ì‹¤íŒ¨í•œ í…ŒìŠ¤íŠ¸:")
        for test, traceback in result.failures:
            print(f"  â€¢ {test}: {traceback}")
    
    if result.errors:
        print("\nâŒ ì˜¤ë¥˜ ë°œìƒ í…ŒìŠ¤íŠ¸:")
        for test, traceback in result.errors:
            print(f"  â€¢ {test}: {traceback}")
    
    if result.wasSuccessful():
        print("\nğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µí–ˆìŠµë‹ˆë‹¤!")
        return 0
    else:
        print("\nâŒ ì¼ë¶€ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
        return 1


if __name__ == "__main__":
    exit(run_tests())