#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Naming Convention Manager
POSCO ì‹œìŠ¤í…œ êµ¬ì„±ìš”ì†Œ

WatchHamster v3.0 ë° POSCO News 250808 250808 í˜¸í™˜
Created: 2025-08-08
"""

import re
from dataclasses import dataclass
from typing import Dict, List, Optional, Tuple
from enum import Enum
from datetime import datetime


class ComponentType(Enum):
    """ì»´í¬ë„ŒíŠ¸ íƒ€ì… ì •ì˜"""
    WATCHHAMSTER = "watchhamster"
    POSCO_NEWS_250808 = "posco_news_250808"
    UNKNOWN = "unknown"


@dataclass
class NamingRule:
    """ë„¤ì´ë° ê·œì¹™ ë°ì´í„° ëª¨ë¸"""
    component: ComponentType
    version: str
    file_pattern: str
    folder_pattern: str
    class_pattern: str
    variable_pattern: str
    comment_pattern: str


@dataclass
class ConversionResult:
    """ë³€í™˜ ê²°ê³¼ ë°ì´í„° ëª¨ë¸"""
    original: str
    converted: str
    component: ComponentType
    conversion_type: str  # "file", "folder", "class", "variable", "comment"
    success: bool
    reason: str = ""


class NamingConventionManager:
    """
    POSCO í”„ë¡œì íŠ¸ ë„¤ì´ë° ì»¨ë²¤ì…˜ ê´€ë¦¬ í´ë˜ìŠ¤
    
    WatchHamster v3.0.0 ë° POSCO News 250808 250808 250808 ë²„ì „ ì²´ê³„ë¥¼ ê´€ë¦¬í•˜ê³ 
    ë‹¤ì–‘í•œ ë„¤ì´ë° ìš”ì†Œë“¤ì„ í‘œì¤€í™”ëœ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
    """
    
    # ë²„ì „ ì •ì˜
    WATCHHAMSTER_VERSION = "v3.0"
    POSCO News 250808 250808_VERSION = "250808"
    
    def __init__(self):
        """ë„¤ì´ë° ì»¨ë²¤ì…˜ ë§¤ë‹ˆì € ì´ˆê¸°í™”"""
        self.naming_rules = self._initialize_naming_rules()
        self.conversion_history: List[ConversionResult] = []
        
    def _initialize_naming_rules(self) -> Dict[ComponentType, NamingRule]:
        """ë„¤ì´ë° ê·œì¹™ ì´ˆê¸°í™”"""
        return {
            ComponentType.WATCHHAMSTER: NamingRule(
                component=ComponentType.WATCHHAMSTER,
                version=self.WATCHHAMSTER_VERSION,
                file_pattern="*_v3.0_*",
                folder_pattern="WatchHamster_v3.0_*",
                class_pattern="*WatchHamster v3.00*",
                variable_pattern="watchhamster_v3_0_*",
                comment_pattern="WatchHamster v3.0"
            ),
            ComponentType.POSCO News 250808 250808: NamingRule(
                component=ComponentType.POSCO News 250808 250808,
                version=self.POSCO News 250808 250808_VERSION,
                file_pattern="*_250808_*",
                folder_pattern="POSCO_News_250808_*",
                class_pattern="*POSCO News 250808 250808*",
                variable_pattern="POSCO News 250808 250808_250808_*",
                comment_pattern="POSCO News 250808 250808"
            )
        }
    
    def detect_component_type(self, name: str) -> ComponentType:
        """
        ì´ë¦„ì—ì„œ ì»´í¬ë„ŒíŠ¸ íƒ€ì…ì„ ê°ì§€
        
        Args:
            name: ë¶„ì„í•  ì´ë¦„
            
        Returns:
            ComponentType: ê°ì§€ëœ ì»´í¬ë„ŒíŠ¸ íƒ€ì…
        """
        name_lower = name.lower()
        
        # ì›Œì¹˜í–„ìŠ¤í„° ê´€ë ¨ í‚¤ì›Œë“œ (ìš°ì„ ìˆœìœ„ ë†’ìŒ)
        watchhamster_keywords = [
            'watchhamster', 'watch_hamster', 'ì›Œì¹˜í–„ìŠ¤í„°',
            'hamster', 'monitor_watchhamster', 'demo_v2',
            'test_v2', 'control_center', 'master_control',
            'ì œì–´ì„¼í„°', 'enhancedprocessmanager', 'notificationmanager',
            'POSCO News 250808 250808'  # ì´ í´ë”ëŠ” WatchHamster v3.0.0ìœ¼ë¡œ ë³€í™˜ë¨
        ]
        
        # POSCO News 250808 250808 ê´€ë ¨ í‚¤ì›Œë“œ
        POSCO News 250808 250808_keywords = [
            'POSCO News 250808 250808', 'posco_main', 'posco_continuous',
            'main_notifier', 'realtime_news',
            'integrated_report', 'news_monitor', 'POSCO News 250808 250808',
            'mainnotifier', 'realtimemonitor', 'POSCO News 250808 250808_mini',
            'POSCO News 250808 250808_250808_version', 'POSCO News 250808 250808_250808'
        ]
        
        # ì •í™•í•œ ë§¤ì¹­ì„ ìœ„í•œ íŠ¹ë³„ ì¼€ì´ìŠ¤ë“¤
        special_watchhamster_cases = [
            'enhancedprocessmanager', 'notificationmanager',
            'POSCO News 250808 250808'
        ]
        
        special_POSCO News 250808 250808_cases = [
            'POSCO News 250808 250808monitor', 'mainnotifier', 'realtimemonitor'
        ]
        
        # íŠ¹ë³„ ì¼€ì´ìŠ¤ ë¨¼ì € í™•ì¸ (ìš°ì„ ìˆœìœ„ê°€ ë†’ìŒ)
        for case in special_watchhamster_cases:
            if case in name_lower:
                return ComponentType.WATCHHAMSTER
                
        for case in special_POSCO News 250808 250808_cases:
            if case in name_lower:
                return ComponentType.POSCO News 250808 250808
        
        # ì›Œì¹˜í–„ìŠ¤í„° í‚¤ì›Œë“œ ë¨¼ì € í™•ì¸ (ìš°ì„ ìˆœìœ„ê°€ ë†’ìŒ)
        for keyword in watchhamster_keywords:
            if keyword in name_lower:
                return ComponentType.WATCHHAMSTER
                
        # POSCO News 250808 250808 í‚¤ì›Œë“œ í™•ì¸
        for keyword in POSCO News 250808 250808_keywords:
            if keyword in name_lower:
                return ComponentType.POSCO News 250808 250808
                
        return ComponentType.UNKNOWN
    
    def standardize_filename(self, filename: str) -> ConversionResult:
        """
        íŒŒì¼ëª…ì„ í‘œì¤€í™”
        
        Args:
            filename: ì›ë³¸ íŒŒì¼ëª…
            
        Returns:
            ConversionResult: ë³€í™˜ ê²°ê³¼
        """
        component = self.detect_component_type(filename)
        
        if component == ComponentType.UNKNOWN:
            result = ConversionResult(
                original=filename,
                converted=filename,
                component=component,
                conversion_type="file",
                success=False,
                reason="Unknown component type"
            )
            self.conversion_history.append(result)
            return result
        
        converted = self._convert_filename(filename, component)
        result = ConversionResult(
            original=filename,
            converted=converted,
            component=component,
            conversion_type="file",
            success=converted != filename
        )
        
        self.conversion_history.append(result)
        return result
    
    def _convert_filename(self, filename: str, component: ComponentType) -> str:
        """íŒŒì¼ëª… ë³€í™˜ ë¡œì§"""
        if component == ComponentType.WATCHHAMSTER:
            return self._convert_watchhamster_filename(filename)
        elif component == ComponentType.POSCO News 250808 250808:
            return self._convert_POSCO News 250808 250808_filename(filename)
        return filename
    
    def _convert_watchhamster_filename(self, filename: str) -> str:
        """ì›Œì¹˜í–„ìŠ¤í„° íŒŒì¼ëª… ë³€í™˜"""
        # ê¸°ì¡´ ë²„ì „ í‘œê¸° ì œê±° ë° v3.0ìœ¼ë¡œ í†µì¼
        patterns = [
            (r'WatchHamster v3.0', 'WatchHamster_v3.0_Control_Center'),
            (r'WatchHamster v3.0.0_Integrated_Center'),
            (r'POSCO_ì œì–´ì„¼í„°_ì‹¤í–‰_v2', 'WatchHamster_v3.0_Control_Panel'),
            (r'demo_v2_integration', 'demo_watchhamster_v3.0_integration'),
            (r'test_v2_integration', 'test_watchhamster_v3.0_integration'),
            (r'test_v2_notification', 'test_watchhamster_v3.0_notification'),
            (r'monitor_WatchHamster(?!.*v3\.0)', 'monitor_WatchHamster_v3.0'),
            (r'_v2\.0?_', '_v3.0_'),
            (r'_v2_', '_v3.0_'),
            (r'_mini_v2', '_v3.0'),
        ]
        
        result = filename
        for pattern, replacement in patterns:
            result = re.sub(pattern, replacement, result, flags=re.IGNORECASE)
        
        return result
    
    def _convert_POSCO News 250808 250808_filename(self, filename: str) -> str:
        """POSCO News 250808 250808 íŒŒì¼ëª… ë³€í™˜"""
        patterns = [
            (r'POSCO News 250808_mini\.py', 'POSCO_News_250808.py'),
            (r'posco_main_notifier', 'POSCO News 250808 250808_250808_notifier'),
            (r'posco_continuous_monitor', 'POSCO News 250808 250808_250808_monitor'),
            (r'POSCO News 250808 250808_data\.json', 'POSCO News 250808 250808_250808_data.json'),
            (r'POSCO News 250808 250808_cache\.json', 'POSCO News 250808 250808_250808_cache.json'),
            (r'POSCO News 250808 250808_historical_cache\.json', 'POSCO News 250808 250808_250808_historical.json'),
        ]
        
        result = filename
        for pattern, replacement in patterns:
            result = re.sub(pattern, replacement, result, flags=re.IGNORECASE)
        
        return result
    
    def standardize_foldername(self, foldername: str) -> ConversionResult:
        """
        í´ë”ëª…ì„ í‘œì¤€í™”
        
        Args:
            foldername: ì›ë³¸ í´ë”ëª…
            
        Returns:
            ConversionResult: ë³€í™˜ ê²°ê³¼
        """
        component = self.detect_component_type(foldername)
        
        if component == ComponentType.UNKNOWN:
            result = ConversionResult(
                original=foldername,
                converted=foldername,
                component=component,
                conversion_type="folder",
                success=False,
                reason="Unknown component type"
            )
            self.conversion_history.append(result)
            return result
        
        converted = self._convert_foldername(foldername, component)
        result = ConversionResult(
            original=foldername,
            converted=converted,
            component=component,
            conversion_type="folder",
            success=converted != foldername
        )
        
        self.conversion_history.append(result)
        return result
    
    def _convert_foldername(self, foldername: str, component: ComponentType) -> str:
        """í´ë”ëª… ë³€í™˜ ë¡œì§"""
        if component == ComponentType.WATCHHAMSTER:
            patterns = [
                (r'WatchHamster_v3.0', 'WatchHamster_v3.0'),
                (r'watchhamster-v3.0-integration', 'watchhamster-v3.0-integration'),
            ]
        elif component == ComponentType.POSCO News 250808 250808:
            patterns = [
                (r'POSCO News 250808_mini(?!.*250808)', 'POSCO_News_250808'),
            ]
        else:
            return foldername
        
        result = foldername
        for pattern, replacement in patterns:
            result = re.sub(pattern, replacement, result, flags=re.IGNORECASE)
        
        return result
    
    def standardize_classname(self, classname: str) -> ConversionResult:
        """
        í´ë˜ìŠ¤ëª…ì„ í‘œì¤€í™”
        
        Args:
            classname: ì›ë³¸ í´ë˜ìŠ¤ëª…
            
        Returns:
            ConversionResult: ë³€í™˜ ê²°ê³¼
        """
        component = self.detect_component_type(classname)
        
        if component == ComponentType.UNKNOWN:
            result = ConversionResult(
                original=classname,
                converted=classname,
                component=component,
                conversion_type="class",
                success=False,
                reason="Unknown component type"
            )
            self.conversion_history.append(result)
            return result
        
        converted = self._convert_classname(classname, component)
        result = ConversionResult(
            original=classname,
            converted=converted,
            component=component,
            conversion_type="class",
            success=converted != classname
        )
        
        self.conversion_history.append(result)
        return result
    
    def _convert_classname(self, classname: str, component: ComponentType) -> str:
        """í´ë˜ìŠ¤ëª… ë³€í™˜ ë¡œì§"""
        if component == ComponentType.WATCHHAMSTER:
            patterns = [
                (r'^PoscoMonitorWatchHamster$', 'WatchHamster v3.00Monitor'),
                (r'^EnhancedProcessManager$', 'WatchHamster v3.00ProcessManager'),
                (r'^WatchhamsterIntegration$', 'WatchHamster v3.00Integration'),
                (r'^NotificationManager$', 'WatchHamster v3.00NotificationManager'),
            ]
        elif component == ComponentType.POSCO News 250808 250808:
            patterns = [
                (r'^POSCO News 250808Monitor$', 'POSCO News 250808 250808Monitor'),
                (r'^MainNotifier$', 'POSCO News 250808 250808Notifier'),
                (r'^RealtimeMonitor$', 'POSCO News 250808 250808RealtimeMonitor'),
            ]
        else:
            return classname
        
        result = classname
        for pattern, replacement in patterns:
            result = re.sub(pattern, replacement, result)
        
        return result
    
    def standardize_variable_name(self, variable_name: str) -> ConversionResult:
        """
        ë³€ìˆ˜ëª…ì„ í‘œì¤€í™”
        
        Args:
            variable_name: ì›ë³¸ ë³€ìˆ˜ëª…
            
        Returns:
            ConversionResult: ë³€í™˜ ê²°ê³¼
        """
        component = self.detect_component_type(variable_name)
        
        if component == ComponentType.UNKNOWN:
            result = ConversionResult(
                original=variable_name,
                converted=variable_name,
                component=component,
                conversion_type="variable",
                success=False,
                reason="Unknown component type"
            )
            self.conversion_history.append(result)
            return result
        
        converted = self._convert_variable_name(variable_name, component)
        result = ConversionResult(
            original=variable_name,
            converted=converted,
            component=component,
            conversion_type="variable",
            success=converted != variable_name
        )
        
        self.conversion_history.append(result)
        return result
    
    def _convert_variable_name(self, variable_name: str, component: ComponentType) -> str:
        """ë³€ìˆ˜ëª… ë³€í™˜ ë¡œì§"""
        if component == ComponentType.WATCHHAMSTER:
            patterns = [
                (r'WATCHHAMSTER_VERSION.*=.*"v2\.0?"', f'WATCHHAMSTER_VERSION = "{self.WATCHHAMSTER_VERSION}"'),
                (r'watchhamster_v2', 'watchhamster_v3_0'),
                (r'watchhamster_v3_0_version', 'watchhamster_v3_0_version'),
            ]
        elif component == ComponentType.POSCO News 250808 250808:
            patterns = [
                (r'POSCO News 250808 250808"', f'POSCO News 250808 250808_VERSION = "{self.POSCO News 250808 250808_VERSION}"'),
                (r'POSCO News 250808 250808_250808_data', 'POSCO News 250808 250808_250808_data'),
                (r'POSCO News 250808 250808_250808(?!_)', 'POSCO News 250808 250808_250808'),
                (r'^POSCO News 250808 250808_250808_version$', 'POSCO News 250808 250808_250808_version'),
            ]
        else:
            return variable_name
        
        result = variable_name
        for pattern, replacement in patterns:
            result = re.sub(pattern, replacement, result)
        
        return result
    
    def get_version_info(self) -> Dict[str, str]:
        """ë²„ì „ ì •ë³´ ë°˜í™˜"""
        return {
            "watchwatchhamster_v3_0_version": self.WATCHHAMSTER_VERSION,
            "posco_POSCO News 250808 250808_250808_version": self.POSCO News 250808 250808_VERSION,
            "last_updated": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        }
    
    def get_conversion_statistics(self) -> Dict[str, int]:
        """ë³€í™˜ í†µê³„ ë°˜í™˜"""
        stats = {
            "total_conversions": len(self.conversion_history),
            "successful_conversions": sum(1 for r in self.conversion_history if r.success),
            "failed_conversions": sum(1 for r in self.conversion_history if not r.success),
            "watchhamster_conversions": sum(1 for r in self.conversion_history if r.component == ComponentType.WATCHHAMSTER),
            "POSCO News 250808 250808_conversions": sum(1 for r in self.conversion_history if r.component == ComponentType.POSCO News 250808 250808),
        }
        return stats
    
    def generate_conversion_report(self) -> str:
        """ë³€í™˜ ë³´ê³ ì„œ ìƒì„±"""
        stats = self.get_conversion_statistics()
        version_info = self.get_version_info()
        
        report = f"""
POSCO ë„¤ì´ë° ì»¨ë²¤ì…˜ ë³€í™˜ ë³´ê³ ì„œ
=====================================

ë²„ì „ ì •ë³´:
- WatchHamster: {version_info['watchwatchhamster_v3_0_version']}
- POSCO News 250808: {version_info['posco_POSCO News 250808 250808_250808_version']}
- ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: {version_info['last_updated']}

ë³€í™˜ í†µê³„:
- ì´ ë³€í™˜ ì‹œë„: {stats['total_conversions']}
- ì„±ê³µí•œ ë³€í™˜: {stats['successful_conversions']}
- ì‹¤íŒ¨í•œ ë³€í™˜: {stats['failed_conversions']}
- WatchHamster ê´€ë ¨: {stats['watchhamster_conversions']}
- POSCO News 250808 ê´€ë ¨: {stats['POSCO News 250808 250808_conversions']}

ë³€í™˜ ì„¸ë¶€ ë‚´ì—­:
"""
        
        for result in self.conversion_history:
            status = "âœ“" if result.success else "âœ—"
            report += f"{status} [{result.conversion_type}] {result.original} â†’ {result.converted}\n"
            if not result.success and result.reason:
                report += f"   ì´ìœ : {result.reason}\n"
        
        return report


def main():
    """í…ŒìŠ¤íŠ¸ ë° ë°ëª¨ í•¨ìˆ˜"""
    manager = NamingConventionManager()
    
    # í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë“¤
    test_files = [
        "ğŸ¹WatchHamster v3.0.bat",
        "demo_v2_integration.py",
        "POSCO News 250808_mini.py",
        "posco_main_notifier.py",
        "monitor_WatchHamster.py"
    ]
    
    test_folders = [
        "WatchHamster_v3.0",
        "watchhamster-v3.0-integration"
    ]
    
    test_classes = [
        "PoscoMonitorWatchHamster",
        "EnhancedProcessManager",
        "POSCO News 250808Monitor"
    ]
    
    test_variables = [
        'WATCHHAMSTER_VERSION = "v3.0"',
        'POSCO News 250808 250808_VERSION = "250808"',
        "watchhamster_v3_0_config"
    ]
    
    print("POSCO ë„¤ì´ë° ì»¨ë²¤ì…˜ ê´€ë¦¬ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸")
    print("=" * 50)
    
    # íŒŒì¼ëª… í…ŒìŠ¤íŠ¸
    print("\níŒŒì¼ëª… ë³€í™˜ í…ŒìŠ¤íŠ¸:")
    for filename in test_files:
        result = manager.standardize_filename(filename)
        print(f"  {result.original} â†’ {result.converted} ({'ì„±ê³µ' if result.success else 'ì‹¤íŒ¨'})")
    
    # í´ë”ëª… í…ŒìŠ¤íŠ¸
    print("\ní´ë”ëª… ë³€í™˜ í…ŒìŠ¤íŠ¸:")
    for foldername in test_folders:
        result = manager.standardize_foldername(foldername)
        print(f"  {result.original} â†’ {result.converted} ({'ì„±ê³µ' if result.success else 'ì‹¤íŒ¨'})")
    
    # í´ë˜ìŠ¤ëª… í…ŒìŠ¤íŠ¸
    print("\ní´ë˜ìŠ¤ëª… ë³€í™˜ í…ŒìŠ¤íŠ¸:")
    for classname in test_classes:
        result = manager.standardize_classname(classname)
        print(f"  {result.original} â†’ {result.converted} ({'ì„±ê³µ' if result.success else 'ì‹¤íŒ¨'})")
    
    # ë³€ìˆ˜ëª… í…ŒìŠ¤íŠ¸
    print("\në³€ìˆ˜ëª… ë³€í™˜ í…ŒìŠ¤íŠ¸:")
    for variable in test_variables:
        result = manager.standardize_variable_name(variable)
        print(f"  {result.original} â†’ {result.converted} ({'ì„±ê³µ' if result.success else 'ì‹¤íŒ¨'})")
    
    # í†µê³„ ì¶œë ¥
    print(f"\në³€í™˜ í†µê³„:")
    stats = manager.get_conversion_statistics()
    for key, value in stats.items():
        print(f"  {key}: {value}")


if __name__ == "__main__":
    main()