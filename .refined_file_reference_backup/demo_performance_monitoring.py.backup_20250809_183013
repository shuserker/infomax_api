#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Demo Performance Monitoring
POSCO ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

WatchHamster v3.0 ë° POSCO News 250808 í˜¸í™˜
Created: 2025-08-08
"""

import system_functionality_verification.py
import posco_news_250808_monitor.log
import .comprehensive_repair_backup/realtime_news_monitor.py.backup_20250809_181657
import test_config.json
# BROKEN_REF: from datetime import datetime

# ê²½ë¡œ ì„¤ì •
current_dir = os.path.dirname(os.path.abspath(__file__))
sys.path.insert(0, os.path.join(current_dir, 'Monitoring', 'WatchHamster_v3.0'))

try:
# BROKEN_REF:     from Monitoring/WatchHamster_v3.0/core/performance_monitor.py import PerformanceMonitor, PerformanceComparator
# BROKEN_REF:     from Monitoring/WatchHamster_v3.0/core/performance_optimizer.py import PerformanceOptimizer
except ImportError as e:
# BROKEN_REF:     print(f"âŒ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ëª¨ë“ˆ import ì‹¤íŒ¨: {e}")
    sys.exit(1)

def print_header(title):
    """í—¤ë” ì¶œë ¥"""
print("/n"_+_" = " * 60)
    print(f"ğŸ¯ {title}")
    print("=" * 60)

def print_section(title):
    """ì„¹ì…˜ í—¤ë” ì¶œë ¥"""
    print(f"/nğŸ“‹ {title}")
    print("-" * 40)

def demo_performance_monitoring():
    """ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ë°ëª¨"""
    print_header("POSCO WatchHamster v3.0.0 ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ë°ëª¨")
    
    # ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
    print_section("1. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì´ˆê¸°í™”")
    
    script_dir = current_dir
    performance_monitor = PerformanceMonitor(script_dir, monitoring_interval=2)
    performance_optimizer = PerformanceOptimizer(script_dir)
    performance_comparator = PerformanceComparator(script_dir)
    
    print("âœ… PerformanceMonitor ì´ˆê¸°í™” ì™„ë£Œ")
    print("âœ… PerformanceOptimizer ì´ˆê¸°í™” ì™„ë£Œ")
    print("âœ… PerformanceComparator ì´ˆê¸°í™” ì™„ë£Œ")
    
    # ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œì‘
    print_section("2. ì‹¤ì‹œê°„ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œì‘")
    
    performance_monitor.start_monitoring()
    print("ğŸš€ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œì‘ë¨ (2ì´ˆ ê°„ê²©)")
    
    # ë°ì´í„° ìˆ˜ì§‘ ëŒ€ê¸°
    print("ğŸ“Š ì„±ëŠ¥ ë°ì´í„° ìˆ˜ì§‘ ì¤‘...")
    for i in range(5):
        time.sleep(2)
        print(f"  â€¢ {i+1}/5 ë°ì´í„° í¬ì¸íŠ¸ ìˆ˜ì§‘ë¨")
    
    # ì‘ë‹µ ì‹œê°„ ì¸¡ì • ë°ëª¨
    print_section("3. ì‘ë‹µ ì‹œê°„ ì¸¡ì • ë°ëª¨")
    
    print("â±ï¸ ì‘ì—… ì‘ë‹µì‹œê°„ ì¸¡ì • ì¤‘...")
    
    # ë¹ ë¥¸ ì‘ì—… ì‹œë®¬ë ˆì´ì…˜
    with performance_monitor.measure_operation_time("fast_operation"):
        time.sleep(0.5)
    print("  â€¢ ë¹ ë¥¸ ì‘ì—…: 0.5ì´ˆ")
    
    # ë³´í†µ ì‘ì—… ì‹œë®¬ë ˆì´ì…˜
    with performance_monitor.measure_operation_time("normal_operation"):
        time.sleep(1.5)
    print("  â€¢ ë³´í†µ ì‘ì—…: 1.5ì´ˆ")
    
    # ëŠë¦° ì‘ì—… ì‹œë®¬ë ˆì´ì…˜
    with performance_monitor.measure_operation_time("slow_operation"):
        time.sleep(3.0)
    print("  â€¢ ëŠë¦° ì‘ì—…: 3.0ì´ˆ")
    
    # ì„±ëŠ¥ ìš”ì•½ ì¡°íšŒ
    print_section("4. ì„±ëŠ¥ ìš”ì•½ ì¡°íšŒ")
    
    summary = performance_monitor.get_performance_summary()
    
    if 'error' not in summary:
        current = summary['current']
        averages = summary['averages']
        
        print(f"ğŸ“Š í˜„ì¬ ì‹œìŠ¤í…œ ìƒíƒœ:")
        print(f"  â€¢ CPU ì‚¬ìš©ë¥ : {current['cpu_percent']:.1f}%")
        print(f"  â€¢ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : {current['memory_percent']:.1f}%")
        print(f"  â€¢ ì‚¬ìš© ê°€ëŠ¥ ë©”ëª¨ë¦¬: {current['memory_available_mb']:.0f}MB")
        print(f"  â€¢ í”„ë¡œì„¸ìŠ¤ ìˆ˜: {current['process_count']}ê°œ")
        print(f"  â€¢ ì„±ëŠ¥ ìˆ˜ì¤€: {summary['performance_level']}")
        
        print(f"/nğŸ“ˆ í‰ê·  ì„±ëŠ¥ (ìµœê·¼ ì¸¡ì •):")
        print(f"  â€¢ í‰ê·  CPU: {averages['cpu_percent']:.1f}%")
        print(f"  â€¢ í‰ê·  ë©”ëª¨ë¦¬: {averages['memory_percent']:.1f}%")
        print(f"  â€¢ í‰ê·  í”„ë¡œì„¸ìŠ¤ ìˆ˜: {averages['process_count']:.1f}ê°œ")
        
        if summary['response_times']:
            print(f"/nâ±ï¸ ì‘ë‹µì‹œê°„ í†µê³„:")
            for operation, stats in summary['response_times'].items():
                print(f"  â€¢ {operation}: í‰ê·  {stats['avg']:.2f}ì´ˆ (ìµœì†Œ {stats['min']:.2f}ì´ˆ, ìµœëŒ€ {stats['max']:.2f}ì´ˆ)")
    else:
        print(f"âŒ ì„±ëŠ¥ ìš”ì•½ ì¡°íšŒ ì‹¤íŒ¨: {summary['error']}")
    
    # ì„±ëŠ¥ ì´ìŠˆ ë¶„ì„
    print_section("5. ì„±ëŠ¥ ì´ìŠˆ ë¶„ì„ ë° ìµœì í™” ê¶Œì¥ì‚¬í•­")
    
    # ê³ ë¶€í•˜ ìƒí™© ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„°
    high_load_data = {
        'current': {
            'cpu_percent': 85.0,  # ë†’ì€ CPU ì‚¬ìš©ë¥ 
            'memory_percent': 80.0,  # ë†’ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ 
            'disk_usage_percent': 75.0,
            'process_count': 25  # ë§ì€ í”„ë¡œì„¸ìŠ¤
        },
        'response_times': {
            'slow_operation': {'avg': 8.0, 'min': 5.0, 'max': 12.0}  # ëŠë¦° ì‘ë‹µì‹œê°„
        }
    }
    
    print("ğŸ” ê³ ë¶€í•˜ ìƒí™© ì‹œë®¬ë ˆì´ì…˜ ë¶„ì„ ì¤‘...")
    issues = performance_optimizer.analyze_system_performance(high_load_data)
    
    if issues:
        print(f"âš ï¸ {len(issues)}ê°œ ì„±ëŠ¥ ì´ìŠˆ ë°œê²¬:")
        for i, issue in enumerate(issues, 1):
            severity_emoji = {"critical": "ğŸš¨", "warning": "âš ï¸"}.get(issue.severity, "â„¹ï¸")
            print(f"  {i}. {severity_emoji} {issue.description}")
            print(f"     ì˜í–¥ ì»´í¬ë„ŒíŠ¸: {', '.join(issue.affected_components)}")
        
        # ìµœì í™” ê¶Œì¥ì‚¬í•­ ìƒì„±
        print("/nğŸ’¡ ìµœì í™” ê¶Œì¥ì‚¬í•­ ìƒì„± ì¤‘...")
        recommendations = performance_optimizer.generate_optimization_recommendations(issues)
        
        if recommendations:
            print(f"ğŸ“‹ {len(recommendations)}ê°œ ìµœì í™” ê¶Œì¥ì‚¬í•­ ìƒì„±ë¨:")
            for i, rec in enumerate(recommendations[:5], 1):  # ìµœëŒ€ 5ê°œë§Œ í‘œì‹œ
                priority_emoji = {"critical": "ğŸš¨", "high": "âš ï¸", "medium": "ğŸ“‹", "low": "â„¹ï¸"}.get(rec.priority.value, "â€¢")
                print(f"  {i}. {priority_emoji} {rec.title}")
                print(f"     ì¹´í…Œê³ ë¦¬: {rec.category.value}")
                print(f"     ìš°ì„ ìˆœìœ„: {rec.priority.value}")
                print(f"     ì˜ˆìƒ íš¨ê³¼: {rec.estimated_improvement}")
                print(f"     ìœ„í—˜ë„: {rec.risk_level}")
    else:
        print("âœ… ì„±ëŠ¥ ì´ìŠˆê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤")
    
    # v1/v2 ì„±ëŠ¥ ë¹„êµ ë°ëª¨
    print_section("6. v1/v2 ì„±ëŠ¥ ë¹„êµ ë°ëª¨")
    
    # v1 ê¸°ì¤€ì„  ìˆ˜ì§‘
    print("ğŸ“Š v1 ì‹œìŠ¤í…œ ê¸°ì¤€ì„  ìˆ˜ì§‘ ì¤‘...")
    v1_baseline = performance_comparator.collect_v1_baseline()
    
    if v1_baseline:
        print("âœ… v1 ê¸°ì¤€ì„  ìˆ˜ì§‘ ì™„ë£Œ")
        print(f"  â€¢ v1 CPU ì‚¬ìš©ë¥ : {v1_baseline.get('cpu_percent', 0):.1f}%")
        print(f"  â€¢ v1 ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : {v1_baseline.get('memory_percent', 0):.1f}%")
        print(f"  â€¢ v1 í”„ë¡œì„¸ìŠ¤ ìˆ˜: {v1_baseline.get('process_count', 0)}ê°œ")
        
        # v2 ì„±ëŠ¥ ë°ì´í„° (í˜„ì¬ ì‹œìŠ¤í…œ)
        v2_data = {
            'cpu_percent': summary['averages']['cpu_percent'] if 'error' not in summary else 40.0,
            'memory_percent': summary['averages']['memory_percent'] if 'error' not in summary else 50.0,
            'process_count': summary['averages']['process_count'] if 'error' not in summary else 8,
            'response_time_avg': 2.0  # ê°œì„ ëœ ì‘ë‹µì‹œê°„
        }
        
        # ì„±ëŠ¥ ë¹„êµ ë³´ê³ ì„œ ìƒì„±
        print("/nğŸ“‹ v1/v2 ì„±ëŠ¥ ë¹„êµ ë³´ê³ ì„œ ìƒì„± ì¤‘...")
        comparison_report = performance_comparator.generate_comparison_report(v1_baseline, v2_data)
        
        print("âœ… ë¹„êµ ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ")
        print("/n" + "â”€" * 60)
        print(comparison_report)
        print("â”€" * 60)
        
        # ë³´ê³ ì„œ íŒŒì¼ ì €ì¥
        report_file = performance_comparator.save_comparison_report(comparison_report)
        if report_file:
            print(f"ğŸ’¾ ë¹„êµ ë³´ê³ ì„œ ì €ì¥ë¨: {os.path.basename(report_file)}")
    else:
        print("âš ï¸ v1 ê¸°ì¤€ì„  ìˆ˜ì§‘ ì‹¤íŒ¨")
    
    # ìµœì í™” ìš”ì•½ ë³´ê³ ì„œ
    print_section("7. ìµœì í™” ìš”ì•½ ë³´ê³ ì„œ")
    
    optimization_summary = performance_optimizer.get_optimization_summary()
    
    if 'error' not in optimization_summary:
        print("ğŸ“Š ìµœì í™” í˜„í™©:")
        print(f"  â€¢ ì´ ê¶Œì¥ì‚¬í•­: {optimization_summary['total_recommendations']}ê°œ")
        print(f"  â€¢ ì ìš©ëœ ìµœì í™”: {optimization_summary['applied_optimizations']}ê°œ")
        print(f"  â€¢ ëŒ€ê¸° ì¤‘ì¸ ìµœì í™”: {optimization_summary['pending_optimizations']}ê°œ")
        
        if optimization_summary['category_breakdown']:
            print(f"/nğŸ“‹ ì¹´í…Œê³ ë¦¬ë³„ ë¶„ì„:")
            for category, count in optimization_summary['category_breakdown'].items():
                print(f"  â€¢ {category}: {count}ê°œ")
        
        if optimization_summary['priority_breakdown']:
            print(f"/nâš¡ ìš°ì„ ìˆœìœ„ë³„ ë¶„ì„:")
            for priority, count in optimization_summary['priority_breakdown'].items():
                priority_emoji = {"critical": "ğŸš¨", "high": "âš ï¸", "medium": "ğŸ“‹", "low": "â„¹ï¸"}.get(priority, "â€¢")
                print(f"  â€¢ {priority_emoji} {priority}: {count}ê°œ")
        
        # ìµœì í™” ë³´ê³ ì„œ ìƒì„±
        print("/nğŸ“‹ ìƒì„¸ ìµœì í™” ë³´ê³ ì„œ ìƒì„± ì¤‘...")
        optimization_report = performance_optimizer.generate_optimization_report()
        
        print("âœ… ìµœì í™” ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ")
        print("/n" + "â”€" * 60)
        print(optimization_report)
        print("â”€" * 60)
    else:
        print(f"âŒ ìµœì í™” ìš”ì•½ ì¡°íšŒ ì‹¤íŒ¨: {optimization_summary['error']}")
    
    # ì„±ëŠ¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
    print_section("8. ì„±ëŠ¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°")
    
    export_file = performance_monitor.export_performance_data()
    
    if export_file:
        print(f"âœ… ì„±ëŠ¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì™„ë£Œ: {os.path.basename(export_file)}")
        
        # ë‚´ë³´ë‚¸ íŒŒì¼ í¬ê¸° í™•ì¸
        file_size = os.path.getsize(export_file) / 1024  # KB
        print(f"ğŸ“ íŒŒì¼ í¬ê¸°: {file_size:.1f}KB")
        
        # ë‚´ë³´ë‚¸ ë°ì´í„° êµ¬ì¡° í™•ì¸
        try:
with_open(export_file,_'r',_encoding = 'utf-8') as f:
                export_data = json.load(f)
            
            print("ğŸ“Š ë‚´ë³´ë‚¸ ë°ì´í„° êµ¬ì¡°:")
            print(f"  â€¢ ëª¨ë‹ˆí„°ë§ ê¸°ê°„: {export_data.get('monitoring_period', {}).get('duration_seconds', 0):.0f}ì´ˆ")
            print(f"  â€¢ ì´ ì¸¡ì • íšŸìˆ˜: {export_data.get('total_measurements', 0)}íšŒ")
            print(f"  â€¢ ì•Œë¦¼ ë°œìƒ íšŸìˆ˜: {export_data.get('alert_count', 0)}íšŒ")
            print(f"  â€¢ ë©”íŠ¸ë¦­ íˆìŠ¤í† ë¦¬: {len(export_data.get('metrics_history', []))}ê°œ ë°ì´í„° í¬ì¸íŠ¸")
        except Exception as e:
            print(f"âš ï¸ ë‚´ë³´ë‚¸ ë°ì´í„° ë¶„ì„ ì‹¤íŒ¨: {e}")
    else:
        print("âŒ ì„±ëŠ¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨")
    
    # ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì¤‘ì§€
    print_section("9. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì¢…ë£Œ")
    
    performance_monitor.stop_monitoring()
    print("ğŸ›‘ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì¤‘ì§€ë¨")
    
    # ìµœì¢… í†µê³„
    final_summary = performance_monitor.get_performance_summary()
    if 'error' not in final_summary:
        uptime = final_summary.get('uptime_formatted', 'ì•Œ ìˆ˜ ì—†ìŒ')
        total_measurements = final_summary.get('total_measurements', 0)
        alert_count = final_summary.get('alert_count', 0)
        
        print(f"ğŸ“Š ìµœì¢… í†µê³„:")
        print(f"  â€¢ ì´ ê°€ë™ì‹œê°„: {uptime}")
        print(f"  â€¢ ì´ ì¸¡ì • íšŸìˆ˜: {total_measurements}íšŒ")
        print(f"  â€¢ ì´ ì•Œë¦¼ íšŸìˆ˜: {alert_count}íšŒ")
    
    print_header("ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ë°ëª¨ ì™„ë£Œ")
    print("ğŸ‰ POSCO WatchHamster v3.0.0 ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ë°ëª¨ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!")
    print("/nì£¼ìš” ê¸°ëŠ¥:")
    print("âœ… ì‹¤ì‹œê°„ CPU/ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¶”ì ")
    print("âœ… í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬ ì‘ì—… ì‘ë‹µì‹œê°„ ëª¨ë‹ˆí„°ë§")
    print("âœ… v1/v2 ì‹œìŠ¤í…œ ê°„ ì„±ëŠ¥ ë¹„êµ ë¶„ì„")
    print("âœ… ìë™ ì„±ëŠ¥ ì´ìŠˆ ê°ì§€ ë° ë¶„ì„")
    print("âœ… ìµœì í™” ê¶Œì¥ì‚¬í•­ ìƒì„± ë° ê´€ë¦¬")
    print("âœ… ì„±ëŠ¥ ì•Œë¦¼ ë° ë³´ê³ ì„œ ì‹œìŠ¤í…œ")
    print("âœ… ì„±ëŠ¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸° ë° íˆìŠ¤í† ë¦¬ ê´€ë¦¬")

if __name__ == '__main__':
    try:
        demo_performance_monitoring()
    except KeyboardInterrupt:
        print("/n/nâš ï¸ ì‚¬ìš©ìì— ì˜í•´ ë°ëª¨ê°€ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.")
    except Exception as e:
        print(f"/nâŒ ë°ëª¨ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
# BROKEN_REF:         import traceback
        traceback.print_exc()
    finally:
        print("/nğŸ‘‹ ë°ëª¨ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.")